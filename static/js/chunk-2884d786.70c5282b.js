(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2884d786"],{1148:function(t,e,i){"use strict";var r=i("a691"),n=i("1d80");t.exports="".repeat||function(t){var e=String(n(this)),i="",o=r(t);if(o<0||o==1/0)throw RangeError("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(e+=e))1&o&&(i+=e);return i}},"408a":function(t,e,i){var r=i("c6b6");t.exports=function(t){if("number"!=typeof t&&"Number"!=r(t))throw TypeError("Incorrect invocation");return+t}},"7e66":function(t,e,i){var r,n,o;!function(i,s){n=[],r=s,o="function"===typeof r?r.apply(e,n):r,void 0===o||(t.exports=o)}(0,(function(){"use strict";var t,e=function(){};t=!1,e.extend=function(i){var r=null;function n(){t||(r&&(this._superprototype=r.prototype),this.init.apply(this,arguments))}for(var o in this!==e&&(r=this),r&&(t=!0,(n.prototype=new r).constructor=n,t=!1),n.extend=e.extend,i)i.hasOwnProperty(o)&&(n.prototype[o]=r&&"function"==typeof i[o]&&"function"==typeof n.prototype[o]&&/\b_super\b/.test(i[o])?function(t,e){return function(){return this._super=r.prototype[t],e.apply(this,arguments)}}(o,i[o]):i[o]);return n};var i={};function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=[],r=!0,n=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);r=!0);}catch(t){n=!0,o=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw o}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function o(t,e){var i=[],r=!0,n=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);r=!0);}catch(t){n=!0,o=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw o}}return i}function s(t){if(Array.isArray(t))return t}function a(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function h(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function c(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}function u(t,e){var i=(t[0].x-e[0].x)*(t[1].y-e[0].y)-(t[0].y-e[0].y)*(t[1].x-e[0].x),r=(t[0].x-e[1].x)*(t[1].y-e[1].y)-(t[0].y-e[1].y)*(t[1].x-e[1].x);if(0<=i*r)return!1;var n=(e[0].x-t[0].x)*(e[1].y-t[0].y)-(e[0].y-t[0].y)*(e[1].x-t[0].x);return!(0<=n*(n+i-r))}function d(t,e){var i,r,n=e.length,o=0,s=t;i=e[0];for(var a=1;a<=n;++a){if(s.x===i.x&&s.y===i.y)return!0;if(r=e[a%n],s.y<Math.min(i.y,r.y)||s.y>Math.max(i.y,r.y))i=r;else{if(s.y>Math.min(i.y,r.y)&&s.y<Math.max(i.y,r.y)){if(s.x<=Math.max(i.x,r.x)){if(i.y===r.y&&s.x>=Math.min(i.x,r.x))return!0;if(i.x===r.x){if(i.x===s.x)return!0;++o}else{var l=(s.y-i.y)*(r.x-i.x)/(r.y-i.y)+i.x;if(Math.abs(s.x-l)<2e-10)return!0;s.x<l&&++o}}}else if(s.y===r.y&&s.x<=r.x){var h=e[(a+1)%n];s.y>=Math.min(i.y,h.y)&&s.y<=Math.max(i.y,h.y)?++o:o+=2}i=r}}return o%2!=0}function r(t,e){return s(t)||o(t,e)||n()}function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function o(t,e){var i=[],r=!0,n=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(i.push(s.value),!e||i.length!==e);r=!0);}catch(t){n=!0,o=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw o}}return i}function s(t){if(Array.isArray(t))return t}function a(t){return c(t)||h(t)||l()}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function h(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function c(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}function y(t,e,i){var r=t.activeFeature,n=t.activePoint,o=r.points[n.relationNodesIndex[0]],s=r.points[n.relationNodesIndex[1]],a=Math.sqrt((o.x-s.x)*(o.x-s.x)+(o.y-s.y)*(o.y-s.y)),l=(o.y-s.y)/a,h=(o.x-s.x)/a;return 1===l&&0===h||-1===l&&0===h?{dltx:e,dlty:0}:0===l&&1===h||0===l&&-1===h?{dltx:0,dlty:i}:{dltx:0,dlty:0}}function f(t){var e=t.activeFeature,i=t.activePoint,r=e.points[i.relationNodesIndex[0]],n=e.points[i.index],o=Math.sqrt((r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y)),s=(r.y-n.y)/o,a=(r.x-n.x)/o;return 0===s&&1===a||0===s&&-1===a?{flag:"y"}:{flag:"x"}}function r(t,e){return s(t)||o(t,e)||n()}function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function o(t,e){var i=[],r=!0,n=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done);r=!0)if(i.push(s.value),e&&i.length===e)break}catch(t){n=!0,o=t}finally{try{r||null==a["return"]||a["return"]()}finally{if(n)throw o}}return i}function s(t){if(Array.isArray(t))return t}function a(t){return c(t)||h(t)||l()}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function h(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function c(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}return i.config={version:"4.1.3",dpr:window.devicePixelRatio||1},i.constants={textureIcon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAAXNSR0IArs4c6QAAAHZJREFUKBVj/P//vy8DGvg+f77K1ylTmv7/+cODLMWmr7+SCVkAxManmH/RoqUoGggpBhkI10CMYrgGYhWDNZCiGKSB8bWR0WdsoQHyIEgBMgAZzkSKYlBQwz0NMgkUzrhMhsULXAMxikGGgjUQqxisgRTFIA0AbBWFDBQtKoQAAAAASUVORK5CYII="},i.Util={},i.Util.createDiv=function(t,e,i,r){var n=document.createElement("div");return n.id=t,(e||0===e)&&(n.style.width=e+"px"),(i||0===i)&&(n.style.height=i+"px"),r&&(n.style.position="absolute"),n.style.zIndex=1,n},i.Util.createSvg=function(t,e,i,r){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.id=t,(e||0===e)&&(n.setAttribute("width",e+"px"),n.style.width=e+"px"),(i||0===i)&&(n.setAttribute("height",i+"px"),n.style.height=i+"px"),r&&(n.style.position="absolute"),n.style.zIndex=1,n.setAttribute("version","1.1"),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n},i.Util.getDpr=function(){return i.config.dpr},i.Util.createCanvas=function(t,e,r,n){var o=document.createElement("canvas"),s=i.Util.getDpr();return o.id=t,o.width=e*s,o.height=r*s,o.style.width=e+"px",o.style.height=r+"px",n&&(o.style.position="absolute"),o},i.Util.transformScreenXYWithDpr=function(t){var e=i.Util.getDpr();return{x:t.x*e,y:t.y*e}},i.Util.isInArray=function(t,e){for(var i in t)if(t[i]===e)return!0;return!1},i.Util.isObjInArray=function(t,e){for(var i in t)if(t[i].id===e.id)return alert("已被添加，请更换图层id"+e.id),!0;return!1},i.Util.setStyle=function(t,e){var r=i.Util.getDpr();return t.fillStyle=e.fillColor,t.strokeStyle=e.strokeColor,t.lineWidth=e.lineWeight*r,t.globalAlpha=e.opacity,t.lineCap="round",t.lineJoin="round",!0},i.Util.worldToScreen=function(t,e,i){var r=t.getCenter(),n=r.x,o=r.y,s=parseInt(t.w,10)/2,a=parseInt(t.h,10)/2,l=t.zoom/parseInt(t.w,10);return{x:parseFloat(s)+parseFloat((e-n)/l)+0,y:parseFloat(a)-parseFloat((i-o)/l)+0}},i.Util.worldToScreenSize=function(t,e,i){var r=t.zoom/parseInt(t.w,10);return{w:parseFloat(e/r),h:parseFloat(i/r)}},i.Util.screenToWorldDistance=function(t,e){var i=t.zoom/parseInt(t.w,10);return parseFloat((e*i).toFixed(4))},i.Util.worldToScreenDistance=function(t,e){var i=t.zoom/parseInt(t.w,10);return parseFloat((e/i).toFixed(4))},i.Util.screenToWorld=function(t,e,i){var r=t.getCenter(),n=r.x,o=r.y,s=parseInt(t.w,10)/2,a=parseInt(t.h,10)/2,l=t.zoom/parseInt(t.w,10),h=parseFloat(n)+parseFloat((e-s)*l),c=parseFloat(o)-parseFloat((i-a)*l);return{x:parseFloat(h.toFixed(4)),y:parseFloat(c.toFixed(4))}},i.Util.addEvtHandler=function(t,e,r){t["on"+e]=r,"mousewheel"===e&&0===i.Util.getIEVersion()&&t.addEventListener("DOMMouseScroll",r,!1)},i.Util.removeEvtHandler=function(t,e){t["on"+e]=null},i.Util.createEventRegister=function(){return window.addEventListener?function(t,e,i){t.addEventListener(e,i)}:window.attachEvent?function(t,e,i){t.attachEvent("on"+e,(function(){i.call(t,window.event)}))}:function(t,e,i){t["on"+e]=i}},i.Util.createEventCancel=function(){return window.addEventListener?function(t,e,i){t.removeEventListener(e,i,!1)}:window.attachEvent?function(t,e,i){t.detachEvent("on"+e,(function(){i.call(t,window.event)}))}:function(t,e,i){t["on"+e]=null}},i.Util.addEvtHandlerBAK2=i.Util.createEventRegister(),i.Util.removeEvtHandlerBAK2=i.Util.createEventCancel(),i.Util.getMouseXY=function(t,e){var r=0,n=0,o=e.srcElement?e.srcElement:e.target;if(1!==o.nodeType)return{x:r,y:n};if(document.attachEvent){var s="medium"===i.Util.getEleStyle(o,"border-top-width")?0:i.Util.delpx(i.Util.getEleStyle(o,"border-top-width")),a="medium"===i.Util.getEleStyle(o,"border-left-width")?0:i.Util.delpx(i.Util.getEleStyle(o,"border-left-width"));r=e.layerX-a,n=e.layerY-s}else{for(;o&&o!==t;){var l="medium"===i.Util.getEleStyle(o,"border-top-width")?0:i.Util.delpx(i.Util.getEleStyle(o,"border-top-width")),h="medium"===i.Util.getEleStyle(o,"border-left-width")?0:i.Util.delpx(i.Util.getEleStyle(o,"border-left-width"));r+=o.offsetLeft+h,n+=o.offsetTop+l,o=o.offsetParent}r=e.offsetX+r+document.body.scrollLeft,n=e.offsetY+n+document.body.scrollTop}return{x:r,y:n}},i.Util.getMousePos=function(t){var e=t||window.event;return{x:e.screenX,y:e.screenY}},i.Util.getEleStyle=function(t,e){var i=e.split("-"),r=i[0];if(1<r.length)for(var n=1;n<i.length;n++)r+=i[n].substring(0,1).toUpperCase()+i[n].substring(1);else r=e;return t.currentStyle?t.currentStyle[r]:document.defaultView.getComputedStyle(t,!1)[r]},i.Util.delpx=function(t){return t?parseInt(t.substring(0,t.length-2),10):0},i.Util.getRectPointsWithSAndE=function(t,e){var i=e.x,r=t.y,n=t.x,o=e.y;return[{x:t.x,y:t.y},{x:i,y:r},{x:e.x,y:e.y},{x:n,y:o}]},i.Util.pointInCircle=function(t,e){var r=e.point,n=e.radius;return i.Util.distance(t,r)<=n},i.Util.pointInPoly=function(t,e){for(var i=!1,r=-1,n=e.length,o=n-1;++r<n;o=r)(e[r].y<=t.y&&t.y<e[o].y||e[o].y<=t.y&&t.y<e[r].y)&&t.x<(e[o].x-e[r].x)*(t.y-e[r].y)/(e[o].y-e[r].y)+e[r].x&&(i=!i);return i},i.Util.preventDefault=function(t){t.preventDefault?t.preventDefault():window.event.returnValue=!1},i.Util.stopPropagation=function(t){t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0},i.Util.getButton=function(t){if(t=t||window.event,!+[1])switch(t.button){case 0:case 1:case 3:case 5:case 7:return 0;case 2:case 6:return 2;case 4:return 1}return t.button},i.Util.createTextArea=function(t,e,i,r){var n=document.createElement("textarea");return n.id=t,n.style.width=e+"px",n.style.height=i+"px",n.style.resize="none",r&&(n.style.position="absolute"),n.style.zIndex=1,n},i.Util.colorRgb=function(t,e){return"rgba("+parseInt("0x"+t.slice(1,3),10)+","+parseInt("0x"+t.slice(3,5),10)+","+parseInt("0x"+t.slice(5,7),10)+","+e+")"},i.Util.getIEVersion=function(){var t=window.navigator.userAgent.toLowerCase();return/msie 8\.0/i.test(t)?8:/msie 7\.0/i.test(t)?7:/msie 6\.0/i.test(t)?6:0},i.Util.formatGeoPointsWithDlt=function(t,e,i,r){for(var n=e.length,o=t.getZoom()/t.getSize().w,s=i*o,a=r*o,l=[],h=0;h<n;h++){var c=e[h];l.push({x:c.x+s,y:c.y-a})}return l},i.Util.formatGeoPointsWithDeleteIndex=function(t,e,i){for(var r=t.length,n=i||3,o=[],s=0;s<r;s++){var a=t[s];(s!==e||r<=n)&&o.push({x:a.x,y:a.y})}return o},i.Util.calRectNewPointsWithNodesIndexTmpPoint=function(t,e,r,n,o){for(var s=e.length,a=t.getZoom()/t.getSize().w,l=n*a,h=o*a,c=[],u=[],d=0;d<s;d++){var y=e[d],f=i.Util.worldToScreen(t,y.x,y.y);-1!==r.indexOf(d)?(c.push({x:y.x+l,y:y.y-h}),u.push({x:f.x+n,y:f.y+o})):(c.push({x:y.x,y:y.y}),u.push({x:f.x,y:f.y}))}return{points:c,sPoints:u}},i.Util.calPolygonNewPointsWithNodesIndexTmpPoint=function(t,e,r,n){for(var o=e.length,s=[],a=[],l=0;l<o;l++){var h=e[l],c=i.Util.worldToScreen(t,h.x,h.y);if(s.push({x:h.x,y:h.y}),a.push({x:c.x,y:c.y}),l===r){s.push({x:n.x,y:n.y});var u=i.Util.worldToScreen(t,n.x,n.y);a.push({x:u.x,y:u.y})}}return{points:s,sPoints:a}},i.Util.calRectNewPointsWithNodesIndexFormalPoint=function(t,e,r,n,o,s,a){for(var l=e.length,h=t.getZoom()/t.getSize().w,c=o*h,u=s*h,d=[],y=[],f=0;f<l;f++){var p=e[f],g=i.Util.worldToScreen(t,p.x,p.y),v=r.indexOf(f);"y"===a&&0===v||"x"===a&&1===v?(d.push({x:p.x,y:p.y-u}),y.push({x:g.x,y:g.y+s})):"y"===a&&1===v||"x"===a&&0===v?(d.push({x:p.x+c,y:p.y}),y.push({x:g.x+o,y:g.y})):f===n?(d.push({x:p.x+c,y:p.y-u}),y.push({x:g.x+o,y:g.y+s})):(d.push({x:p.x,y:p.y}),y.push({x:g.x,y:g.y}))}return{points:d,sPoints:y}},i.Util.calPolygonNewPointsWithNodesIndexFormalPoint=function(t,e,r,n,o){for(var s=e.length,a=t.getZoom()/t.getSize().w,l=n*a,h=o*a,c=[],u=[],d=0;d<s;d++){var y=e[d],f=i.Util.worldToScreen(t,y.x,y.y);d===r?(c.push({x:y.x+l,y:y.y-h}),u.push({x:f.x+n,y:f.y+o})):(c.push({x:y.x,y:y.y}),u.push({x:f.x,y:f.y}))}return{points:c,sPoints:u}},i.Util.getBounds=function(t,e){if(!t.length)return[];for(var i=t[0].x,r=t[0].y,n=t[0].x,o=t[0].y,s=1;s<t.length;s++)i>t[s].x&&(i=t[s].x),n<t[s].x&&(n=t[s].x),r>t[s].y&&(r=t[s].y),o<t[s].y&&(o=t[s].y);return"bbox"===e?[i,o,n-i,o-r]:[{x:i,y:o},{x:n,y:o},{x:n,y:r},{x:i,y:r}]},i.Util.Key={},i.Util.Key.EVENT="on",i.Util.Key.FLAG={},i.Util.Key.EVENTS={},i.Util.Key.addEventListener=function(t,e){var r=t.join("_");i.Util.Key.EVENTS[r]=e},i.Util.Key.removeEventListener=function(t){var e=t.join("_");delete i.Util.Key.EVENTS[e]},document.addEventListener("keydown",(function(t){var e=t.keyCode;if(i.Util.Key.FLAG[e]=!0,"off"!==i.Util.Key.EVENT)for(var r in i.Util.Key.EVENTS){var n=r.split("_"),o=i.Util.Key.EVENTS[r],s=!0;n.forEach((function(t){i.Util.Key.FLAG[1*t]||(s=!1)})),s&&o()}})),document.addEventListener("keyup",(function(t){var e=t.keyCode;i.Util.Key.FLAG[e]=!1})),i.Util.Key.isActive=function(t){return i.Util.Key.FLAG[t+""]},i.Util.getCirclePoints=function(t,e,i){for(var r=parseInt(360/i,10),n=[],o=0;o<i;o++){var s=o*r,a=t.x+Math.cos(2*Math.PI/360*s)*e,l=t.y+Math.sin(2*Math.PI/360*s)*e;n.push({x:parseFloat(a.toFixed(2)),y:parseFloat(l.toFixed(2))})}return n},i.Util.combinePolygons=function(t){if(t.length<1)return[];if(1===t.length)return t[0];for(var e=t[0].map((function(t){return[t.x,t.y]})),i=PolyBool.segments({regions:[e],inverted:!1}),r=1,n=t.length;r<n;r++){var o=t[r].map((function(t){return[t.x,t.y]})),s=PolyBool.segments({regions:[o],inverted:!1}),a=PolyBool.combine(i,s);i=PolyBool.selectUnion(a)}return(PolyBool.polygon(i).regions[0]||[]).map((function(t){return{x:t[0],y:t[1]}}))},i.Util.colorRGB2Hex=function(t){var e=t.split(",");return"#"+((1<<24)+(parseInt(e[0].split("(")[1],10)<<16)+(parseInt(e[1],10)<<8)+parseInt(e[2].split(")")[0],10)).toString(16).slice(1)},i.Util.colorRGB2Hex2=function(t,e,i){return"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},i.Util.distance=function(t,e){var i=t.x,r=t.y,n=e.x,o=e.y,s=Math.abs(n-i),a=Math.abs(o-r);return Math.sqrt(Math.pow(s,2)+Math.pow(a,2))},i.Util.distancePoint2Line=function(t,e,i,r,n,o){var s,a,l=n-i,h=o-r,c=l*l+h*h,u=-1;0!==c&&(u=((t-i)*l+(e-r)*h)/c),a=u<0?(s=i,r):1<u?(s=n,o):(s=i+u*l,r+u*h);var d=t-s,y=e-a;return Math.sqrt(d*d+y*y)},i.Util.pointToSegDistance=function(t,e,i,r,n,o){var s=(n-i)*(t-i)+(o-r)*(e-r);if(s<=0)return Math.sqrt((t-i)*(t-i)+(e-r)*(e-r));var a=(n-i)*(n-i)+(o-r)*(o-r);if(a<=s)return Math.sqrt((t-n)*(t-n)+(e-o)*(e-o));var l=s/a,h=i+(n-i)*l,c=r+(o-r)*l;return Math.sqrt((t-h)*(t-h)+(c-e)*(c-e))},i.Util.distancePoint2Line=function(t,e,i,r,n,o){var s,a,l=n-i,h=o-r,c=l*l+h*h,u=-1;0!==c&&(u=((t-i)*l+(e-r)*h)/c),a=u<0?(s=i,r):1<u?(s=n,o):(s=i+u*l,r+u*h);var d=t-s,y=e-a;return Math.sqrt(d*d+y*y)},i.Util.polygonArea=function(t){var e,i,r=0;for(e=0;e<t.length;e++)i=(e+1)%t.length,r+=t[e].x*t[i].y,r-=t[e].y*t[i].x;return r/=2,Math.abs(r)},i.Util.roiAreasOrderByLevel=function(t){for(var e=[],i=t.concat([]);0<i.length;)a(i).forEach((function(t){i.shift(),e.unshift(t),t.children&&i.push.apply(i,a(t.children))}));return e},i.Util.polygonCross=function(t,e){return function(t,e){for(var i=0,r=t.length;i<r;i++)for(var n=0,o=e.length;n<o;n++)if(u([t[i],t[i===r-1?0:i+1]],[e[n],e[n===o-1?0:n+1]]))return!0;return!1}(t,e)||(r=e,o=!1,(n=(i=t).some((function(t){return d(t,r)})))||(o=r.some((function(t){return d(t,i)}))),n||o);var i,r,n,o},i.Util.lineLineCross=function(t,e,i,r){var n=(r.x-i.x)*(t.y-i.y)-(r.y-i.y)*(t.x-i.x),o=(e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x),s=(r.y-i.y)*(e.x-t.x)-(r.x-i.x)*(e.y-t.y);if(0!==s){var a=n/s,l=o/s;if(0<=a&&a<=1&&0<=l&&l<=1)return!0}return!1},i.Util.lineCrossPolygon=function(t,e,r){for(var n=r.length,o=0;o<n;++o){var s=r[o],a=r[(o+1)%n];if(i.Util.lineLineCross(t,e,s,a))return!0}return!1},i.Util.polygonInPolygon=function(t,e){for(var r=!0,n=0;n<t.length;n++)if(!i.Util.pointInPoly(t[n],e)){r=!1;break}for(var o=0;o<t.length;++o){var s=t[o],a=t[(o+1)%t.length];if(i.Util.lineCrossPolygon(s,a,e)){r=!1;break}}return r},i.Util.getParent=function(t,e){return function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],i=1<arguments.length?arguments[1]:void 0,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return e.reduce((function(e,n){var o=n.id,s=n.children;return o===i.id?a(r):s?[].concat(a(e),a(t(s,i,[].concat(a(r),[n])))):e}),[])}(t,e)},i.Util.polygonCrossWithParentChildren=function(t,e,r){for(var n=e.children.filter((function(e){return e.id!==t.id})),o=!1,s=0;s<n.length;s++)if(i.Util.polygonCross(n[s].points,r)){o=!0;break}return o},i.Util.childrenInCurrentPolygon=function(t,e){var r=!0;if(e.children&&e.children.length)for(var n=e.children.length,o=0;o<n;o++)if(!i.Util.polygonInPolygon(e.children[o].points,t)){r=!1;break}return r},i.Util.isBBoxIntersect=function(t,e){return!0},i.Util.isInteger=function(t){return"number"==typeof t&&t%1==0},i.Graph={},i.Graph.drawPoint=function(t,e,r){var n=i.Util.transformScreenXYWithDpr(e),o=i.Util.getDpr();t.beginPath(),t.arc(n.x,n.y,(r||3)*o,0,2*Math.PI,!0),t.closePath(),t.fill()},i.Graph.drawPoints=function(t,e,i){for(var r=0;r<e.length;r++){var n={x:e[r].x,y:e[r].y};this.drawPoint(t,n,i)}},i.Graph.drawGeoPoint=function(t,e,r,n){var o=i.Util.worldToScreen(t,r.x,r.y),s=i.Util.transformScreenXYWithDpr(o),a=i.Util.getDpr();e.beginPath(),e.arc(s.x,s.y,(n||3)*a,0,2*Math.PI,!0),e.closePath(),e.fill()},i.Graph.drawGeoPoints=function(t,e,r,n){for(var o=0;o<r.length;o++){var s=i.Util.worldToScreen(t,r[o].x,r[o].y);this.drawPoint(e,s,n)}},i.Graph.drawLine=function(t,e,r){t.beginPath();var n=i.Util.transformScreenXYWithDpr(e),o=i.Util.transformScreenXYWithDpr(r);t.moveTo(n.x,n.y),t.lineTo(o.x,o.y),t.stroke()},i.Graph.drawLines=function(t,e){if(!(e.length<2)){t.beginPath();var r=i.Util.transformScreenXYWithDpr(e[0]);t.moveTo(r.x,r.y);for(var n=1;n<e.length;n++){var o=i.Util.transformScreenXYWithDpr(e[n]);t.lineTo(o.x,o.y)}t.stroke()}},i.Graph.drawLines2=function(t,e){if(!(e.length<2)){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y);t.stroke()}},i.Graph.drawGeoLine=function(t,e,r,n){e.beginPath();var o=i.Util.worldToScreen(t,r.x,r.y),s=i.Util.worldToScreen(t,n.x,n.y);i.Graph.drawLine(e,o,s)},i.Graph.drawGeoLines=function(t,e,r){if(!(r.length<2)){e.beginPath();var n=i.Util.worldToScreen(t,r[0].x,r[0].y),o=i.Util.transformScreenXYWithDpr(n);e.moveTo(o.x,o.y);for(var s=1;s<r.length;s++){var a=i.Util.worldToScreen(t,r[s].x,r[s].y),l=i.Util.transformScreenXYWithDpr(a);e.lineTo(l.x,l.y)}e.stroke()}},i.Graph.drawRect=function(t,e,r,n){var o=i.Util.getDpr(),s=i.Util.transformScreenXYWithDpr(e);t.strokeRect(s.x,s.y,r*o,n*o)},i.Graph.drawGeoRect=function(t,e,r,n,o){var s=i.Util.getDpr(),a=i.Util.worldToScreen(t,r.x,r.y),l=i.Util.worldToScreenSize(t,n,o),h=i.Util.transformScreenXYWithDpr(a);e.strokeRect(h.x,h.y,l.w*s,l.h*s)},i.Graph.drawPolygon=function(t,e,r){var n=e.length;if(2<=n){t.beginPath();var o=i.Util.transformScreenXYWithDpr(e[0]);t.moveTo(o.x,o.y);for(var s=1;s<n;s++)o=i.Util.transformScreenXYWithDpr(e[s]),t.lineTo(o.x,o.y);t.closePath()}!r&&t.stroke()},i.Graph.drawGeoLineWith=function(t,e,r,n){var o=i.Util.worldToScreen(t,r.x,r.y),s=i.Util.worldToScreen(t,n.x,n.y),a=i.Util.transformScreenXYWithDpr(o),l=i.Util.transformScreenXYWithDpr(s);e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(l.x,l.y),e.closePath(),e.stroke()},i.Graph.drawGeoPolygon=function(t,e,r,n){var o=r.length;if(2<=o){e.beginPath();var s=i.Util.worldToScreen(t,r[0].x,r[0].y),a=i.Util.transformScreenXYWithDpr(s);e.moveTo(a.x,a.y);for(var l=1;l<o;l++){var h=i.Util.worldToScreen(t,r[l].x,r[l].y),c=i.Util.transformScreenXYWithDpr(h);e.lineTo(c.x,c.y)}e.closePath()}e.stroke(),n&&e.fill()},i.Graph.drawDashGeoPolygon=function(t,e,r){var n=r.length;if(2<=n){e.beginPath();var o=i.Util.worldToScreen(t,r[0].x,r[0].y),s=i.Util.transformScreenXYWithDpr(o);e.moveTo(s.x,s.y);for(var a=1;a<n;a++){var l=i.Util.worldToScreen(t,r[a].x,r[a].y),h=i.Util.transformScreenXYWithDpr(l);if(e.lineTo(h.x,h.y),a===n-1){if(e.stroke(),n<=2)return;var c=e.globalAlpha;e.setLineDash([10,20]),e.globalAlpha=.3,e.beginPath(),e.moveTo(h.x,h.y),e.lineTo(s.x,s.y),e.stroke(),e.setLineDash([]),e.globalAlpha=c}}}},i.Graph.drawText=function(t,e,r,n){var o=i.Util.transformScreenXYWithDpr({x:r,y:n});e.fillText(t,o.x,o.y)},i.Graph.drawGeoText=function(t,e,r,n,o){var s=i.Util.worldToScreen(t,n,o),a=i.Util.transformScreenXYWithDpr(s);r.fillText(e,a.x,a.y)},i.Graph.drawGeoRectCross=function(t,e,r){var n=r.map((function(t){return t.x})),o=r.map((function(t){return t.y})),s=Math.min.apply(null,n),a=Math.max.apply(null,n),l=Math.min.apply(null,o),h=Math.max.apply(null,o),c=(s+a)/2,u=(l+h)/2,d=1*(a-s)/3,y=1*(h-l)/3,f={start:{x:s+d,y:u},end:{x:s+2*d,y:u}},p={start:{x:c,y:l+y},end:{x:c,y:l+2*y}},g=f.start,v=f.end,x=p.start,m=p.end;i.Graph.drawGeoLine(t,e,g,v),i.Graph.drawGeoLine(t,e,x,m)},i.Graph.clearGeoArc=function(t,e,r,n,o,s){var a=e.x,l=e.y,h=i.Util.worldToScreen(t,a,l),c=i.Util.transformScreenXYWithDpr(h);n.save(),n.beginPath(),n.arc(c.x,c.y,r,0,2*Math.PI),n.clip(),n.clearRect(0,0,o,s),n.restore()},i.Graph.drawClearGeoPolygon=function(t,e,r){var n=r.length;if(2<=n){e.beginPath();var o=i.Util.worldToScreen(t,r[0].x,r[0].y),s=i.Util.transformScreenXYWithDpr(o);e.moveTo(s.x,s.y);for(var a=1;a<n;a++){var l=i.Util.worldToScreen(t,r[a].x,r[a].y);s=i.Util.transformScreenXYWithDpr(l),e.lineTo(s.x,s.y)}e.closePath()}},i.Graph.clearGeoPolygon=function(t,e,r,n,o){r.save(),r.beginPath(),i.Graph.drawClearGeoPolygon(t,r,e),r.clip(),r.clearRect(0,0,n,o),r.restore()},i.Graph.drawGeoRoi=function(t,e,r){r.beginPath(),i.Graph.drawClearGeoPolygon(t,r,e),r.clip()},i.Geometry=e.extend({init:function(t){this.name=t},getVertices:function(){},getBounds:function(){},calcBounds:function(){}}),i.Geometry.Point=e.extend({init:function(t,e){this.x=t,this.y=e,this.className="point"}}),i.Geometry.LineString=i.Geometry.extend({init:function(t){this.className="line",this.points=[];for(var e=0;e<t.length;e++){var r=t[e];r instanceof i.Geometry.Point?this.points.push(r):alert("初始化节点失败！")}},addPoint:function(t,e){/^\d+$/.test(e)?this.points.splice(e,0,t):this.points.push(t)},delPoint:function(t){this.points.splice(t,1)},removePoint:function(t){for(var e=0;e<this.points.length;e++)if(this.points[e]===t){this.points.splice(e,1);break}},getLength:function(){for(var t=this.points.length,e=0,i=0;i<t-1;i++)e+=Math.sqrt((this.points[i].x-this.points[i+1].x)*(this.points[i].x-this.points[i+1].x)+(this.points[i].y-this.points[i+1].y)*(this.points[i].y-this.points[i+1].y));return e}}),i.Geometry.LinearRing=i.Geometry.LineString.extend({init:function(t){if(t.length<=2)alert("组成多边形节点个数不足！");else{this._super(t),this.className="polygon";var e=t[0];this.points.push(e)}},addPoint:function(t,e){this.points.splice(e,0,t)},delPoint:function(t){if(4!==this.points.length){if(this.points.splice(t,1),0===t){this.points.pop();var e=this.points[0];this.points.push(e)}}else alert("节点数低于3个，不能删除！")},getCenterPoint:function(){for(var t=this.points,e=t.length,r=0,n=0,o=0;o<e;o++)r+=t[o].x,n+=t[o].y;var s=r/e,a=n/e;return new i.Geometry.Point(s,a)},getArea:function(){for(var t=0,e=this.points,i=0;i<e.length;i++)t+=e[i].x*e[(i+1)%e.length].y-e[(i+1)%e.length].x*e[i].y;return parseInt(Math.abs(.5*t),10)}}),i.Geometry.RectRing=i.Geometry.LineString.extend({init:function(t){t.length<4?alert("组成矩形节点个数不足！"):(this._super(t),this.className="rect")},addPoint:function(t,e){this.points.splice(e,0,t)},delPoint:function(t){if(4!==this.points.length){if(this.points.splice(t,1),0===t){this.points.pop();var e=this.points[0];this.points.push(e)}}else alert("节点数低于3个，不能删除！")},getArea:function(){for(var t=0,e=this.points,i=0;i<e.length;i++)t+=e[i].x*e[(i+1)%e.length].y-e[(i+1)%e.length].x*e[i].y;return parseInt(Math.abs(.5*t),10)}}),i.Geometry.RadiusRing=i.Geometry.extend({init:function(t,e){this.radius=e,this.centerPoint=t,this.className="radius"},getArea:function(){return 6.28318*this.radius*this.radius}}),i.Feature=e.extend({init:function(t,e,i,r,n){this.activeStatus=!1,this.hoverStatus=!1,this.visible=!1,this.id=t,this.points=e instanceof Array?e:[e],this.data=i||{},this.gStyle=r,this.options=n||{}},onAdd:function(t){this._layerID=t.id,this._layer=t,this.visible=!0,this.setEditVertices(),this.setCrossLine(),this.style=this.gStyle||t.featureStyle||new i.Style({}),this.hoveStyle=t.featureHoverStyle||new i.Style({strokeColor:"#FF0000",lineWeight:1}),this.activeStyle=t.featureActiveStyle||new i.Style({strokeColor:"#FF0000",lineWeight:1}),this.onDraw(t)},setCrossLine:function(){},onRemove:function(t){},getVertices:function(){return this.points},setEditVertices:function(){var t=this.points,e=this.options&&this.options.edgeFixed,r=t.length,n=this._layer.getMap(),o="point"===this.type,s="polyline"===this.type,a=[];if(o)return a;for(var l=0;l<r-1;l++){var h=t[l],c=t[l+1],u=-1<l-1?l-1:s?void 0:r-1,d=void 0===u?void 0:(t[u].y-c.y)/(t[u].x-c.x);a.push({point:h,sPoint:i.Util.worldToScreen(n,h.x,h.y),type:"formal",index:l,k:d?-1/d:void 0,relationNodesIndex:[u,l+1]});var y={x:(h.x+c.x)/2,y:(h.y+c.y)/2},f=(c.y-h.y)/(c.x-h.x);if(!e&&a.push({point:y,sPoint:i.Util.worldToScreen(n,y.x,y.y),type:"tmp",index:l,k:-1/f,relationNodesIndex:[l,l+1]}),l===r-2){var p=s?void 0:0,g=void 0===p?void 0:(t[p].y-h.y)/(t[p].x-h.x);if(a.push({point:c,sPoint:i.Util.worldToScreen(n,c.x,c.y),type:"formal",index:l+1,k:g?-1/g:void 0,relationNodesIndex:[l,p]}),!s){var v=t[p],x={x:(v.x+c.x)/2,y:(v.y+c.y)/2},m=(t[p].y-c.y)/(t[p].x-c.x);!e&&a.push({point:x,sPoint:i.Util.worldToScreen(n,x.x,x.y),type:"tmp",index:l,k:-1/m,relationNodesIndex:[l+1,p]})}}}this._editPoints=a},catchPointWithPos:function(t){if(!this.visible||"point"===this.type)return{flag:!1,point:null};for(var e=this._editPoints,r=this._layer.getMap(),n=i.Util.worldToScreen(r,t.x,t.y),o=e.length,s=0;s<o;s++){var a=e[s].sPoint,l=(n.x-a.x)*(n.x-a.x)+(n.y-a.y)*(n.y-a.y);if(Math.sqrt(l)<=10)return{flag:!0,point:e[s]}}return{flag:!1,point:null}},show:function(){this.visible||(this.visible=!0,this._layer.renew())},hide:function(){this.visible&&(this.visible=!1,this._layer.renew())},update:function(t){"point"===this.type?this.points=t.point?t.point instanceof Array?t.point:[t.point]:this.points:this.points=t.points?t.points instanceof Array?t.points:[t.points]:this.points,this.data=t.data||this.data,this.style=t.style||this.style,t.points&&(this.setEditVertices(),this.setCrossLine()),this._layer.renew()},hover:function(t){this.hoverStatus||(this.hoveStyle=t||this.hoveStyle,this.hoverStatus=!0,this._layer.renew())},deHover:function(){this.hoverStatus&&(this.hoverStatus=!1,this._layer.renew())},active:function(t){this.activeStatus||"point"===this.type||(this.activeStyle=t||this.activeStyle,this.activeStatus=!0,this._layer.renew())},deActive:function(){this.activeStatus&&"point"!==this.type&&(this.activeStatus=!1,this._layer.renew())},getStyle:function(){return this.activeStatus||this.hoverStatus,this.style},getBounds:function(){for(var t=this.getVertices(),e=t[0].x,i=t[0].y,r=t[0].x,n=t[0].y,o=1;o<t.length;o++)e>t[o].x&&(e=t[o].x),r<t[o].x&&(r=t[o].x),i>t[o].y&&(i=t[o].y),n<t[o].y&&(n=t[o].y);return[{x:e,y:n},{x:r,y:n},{x:r,y:i},{x:e,y:i}]},setVerticesActiveStatus:function(){if(this.activeStatus){var t=this._layer.getCtx(),e=this._layer.getMap(),r=this._editPoints.filter((function(t){return"formal"===t.type})),n=this._editPoints.filter((function(t){return"tmp"===t.type}));t.globalAlpha=1,t.fillStyle="#FF0000",i.Graph.drawGeoPoints(e,t,r.map((function(t){return t.point}))),t.globalAlpha=1,t.fillStyle="#FF9900",i.Graph.drawGeoPoints(e,t,n.map((function(t){return t.point})))}}}),i.Feature.Close=i.Feature.extend({isCaught:function(t){return!(!i.Util.pointInPoly(t,this.points)||!this.visible)},getStyleSize:function(){var t=i.Util.getDpr();return this.style.lineWeight*t},onDraw:function(t){if(this.visible){var e=t.getCtx(),r=this.getStyle(),n=i.Util.getDpr();i.Util.setStyle(e,r),this.hoverStatus&&!this.activeStatus&&(this.cross?e.strokeStyle="#FFD700":e.lineWidth=2*r.lineWeight*n),r.lineDash?e.setLineDash([10,5]):e.setLineDash([]),e.globalAlpha=1,this.activeStatus&&(e.strokeStyle=this.options.activeColor||"#FF0000");var o=this.points.length;if(2<=o){e.beginPath();var s=i.Util.worldToScreen(t._map,this.points[0].x,this.points[0].y),a=i.Util.transformScreenXYWithDpr(s);e.moveTo(a.x,a.y);for(var l=1;l<o;l++)s=i.Util.worldToScreen(t._map,this.points[l].x,this.points[l].y),a=i.Util.transformScreenXYWithDpr(s),e.lineTo(a.x,a.y);e.closePath()}e.stroke(),t._opacity?e.globalAlpha=0:e.globalAlpha=this.style.opacity,e.fill(),this.setVerticesActiveStatus(),this.drawRectCross(t)}},setCrossLine:function(){if(!this.cross)return this.crossHorizontalLine=null,this.crossVerticalLine=null,void(this.crossCenter=null);var t=this.getBounds(),e=t.map((function(t){return t.x})),i=t.map((function(t){return t.y})),r=Math.min.apply(null,e),n=Math.max.apply(null,e),o=Math.min.apply(null,i),s=Math.max.apply(null,i),a=(r+n)/2,l=(o+s)/2,h=1*(n-r)/3,c=1*(s-o)/3;this.crossHorizontalLine={start:{x:r+h,y:l},end:{x:r+2*h,y:l}},this.crossVerticalLine={start:{x:a,y:o+c},end:{x:a,y:o+2*c}},this.crossCenter={x:a,y:l}},drawRectCross:function(t){var e=t.getCtx(),r=i.Util.getDpr(),n=this.getStyle(),o=n.lineWeight,s=n.strokeColor,a=this.crossHorizontalLine,l=this.crossVerticalLine;if(a&&l){e.lineWidth=o*r,e.setLineDash([]),e.globalAlpha=1,this.hoverStatus?e.strokeStyle="#FFD700":e.strokeStyle=s;var h=a.start,c=a.end,u=l.start,d=l.end;i.Graph.drawGeoLine(t._map,e,h,c),i.Graph.drawGeoLine(t._map,e,u,d)}}}),i.Feature.Rect=i.Feature.Close.extend({init:function(t,e,i,r){var n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};this._super(t,e,i,r,n),this.cross=!!n.cross,this.type="rect"}}),i.Feature.Polygon=i.Feature.Close.extend({init:function(t,e,i,r,n){this._super(t,e,i,r,n),this.type="polygon"}}),i.Feature.Point=i.Feature.extend({init:function(t,e,i,r,n){this._super(t,e,i,r,n);var o=(n||{}).radius;this.radius=o,this.type="point"},getStyleSize:function(){var t=this._layer.getMap();return this.radius&&0<this.radius?i.Util.worldToScreenDistance(t,this.radius):this.style.pointRadius},isCaught:function(t){var e=this.points[0],r=this._layer.getMap(),n=e.x,o=e.y,s=t.x,a=t.y,l=Math.abs(s-n),h=Math.abs(a-o),c=Math.sqrt(Math.pow(l,2)+Math.pow(h,2));return i.Util.worldToScreenDistance(r,c)-this.getStyleSize()<=4},onDraw:function(t){if(this.visible){var e=this.getStyle(),r=t.getMap(),n=t.getCtx(),o=this.points[0],s=this.getStyleSize();i.Util.setStyle(n,e),i.Graph.drawGeoPoint(r,n,o,s)}}}),i.Feature.Polyline=i.Feature.extend({init:function(t,e,i,r,n){this._super(t,e,i,r,n);var o=n||{},s=o.width,a=o.unSelected,l=void 0!==a&&a;this.unSelected=l,this.lineWidth=s,this.type="polyline"},getStyleSize:function(){var t=i.Util.getDpr(),e=this._layer.getMap();return this.lineWidth&&0<this.lineWidth?i.Util.worldToScreenDistance(e,this.lineWidth)*t:this.style.lineWeight*t},isCaught:function(t){return!(!this.isCaughtInner(t)||!this.visible||this.unSelected)},isCaughtInner:function(t){for(var e=1e7,r=this._layer.getMap(),n=this.points,o=n.length-1,s=t.x,a=t.y,l=0;l<o;l++){var h=n[l],c=n[l+1],u=void 0,d=(c.x-h.x)*(s-h.x)+(c.y-h.y)*(a-h.y),y=(c.x-h.x)*(c.x-h.x)+(c.y-h.y)*(c.y-h.y);if(d<=0)u=Math.sqrt((s-h.x)*(s-h.x)+(a-h.y)*(a-h.y));else if(y<=d)u=Math.sqrt((s-c.x)*(s-c.x)+(a-c.y)*(a-c.y));else{var f=d/y,p=h.x+(c.x-h.x)*f,g=h.y+(c.y-h.y)*f;u=Math.sqrt((s-p)*(s-p)+(g-a)*(g-a))}u<e&&(e=u)}if(this.lineWidth){var v=e-this.lineWidth/2;return v<=0||i.Util.worldToScreenDistance(r,v)<=4}return i.Util.worldToScreenDistance(r,e)<=4},onDraw:function(t){if(this.visible){var e=t.getMap(),r=t.getCtx(),n=this.getStyle(),o=i.Util.getDpr();if(i.Util.setStyle(r,n),this.lineWidth&&0<this.lineWidth){var s=i.Util.worldToScreenDistance(e,this.lineWidth);r.lineWidth=s*o}var a=n.opacity,l=void 0===a?1:a;if((l||0===l)&&(r.globalAlpha=l),this.hoverStatus&&!this.activeStatus){var h=l+.1;r.globalAlpha=h<=1?h:l-.1}this.activeStatus&&(r.strokeStyle=this.options.activeColor||"#FF0000");var c=this.points.length;if(2<=c){r.beginPath();var u=i.Util.worldToScreen(t._map,this.points[0].x,this.points[0].y),d=i.Util.transformScreenXYWithDpr(u);r.moveTo(d.x,d.y);for(var y=1;y<c;y++)u=i.Util.worldToScreen(t._map,this.points[y].x,this.points[y].y),d=i.Util.transformScreenXYWithDpr(u),r.lineTo(d.x,d.y)}r.stroke(),t._opacity?r.globalAlpha=0:r.globalAlpha=this.style.opacity,this.setVerticesActiveStatus()}}}),i.Feature.Roi=e.extend({init:function(t,e,i,r,n,o){this.activeStatus=!1,this.hoverStatus=!1,this.hoveStyle={},this.id=t,this.visible=!0,this.points=i,this.data=r||{},this.gStyle=n,this.options=o||{},this.roiType=e,this.type="roi",this.children=null},isCaught:function(t){return!(!i.Util.pointInPoly(t,this.points)||!this.visible)},hover:function(t){this.hoverStatus||(this.hoveStyle=t||this.hoveStyle,this.hoverStatus=!0,this._layer.renew())},active:function(t){this.activeStatus||(this.activeStyle=t||this.activeStyle,this.activeStatus=!0,this._layer.renew())},onAdd:function(t){this._layer=t,this.setEditVertices(),this.style=this.gStyle||t.featureStyle||new i.Style({}),this.hoveStyle=t.featureHoverStyle||new i.Style({strokeColor:"#FF0000",lineWeight:1}),this.activeStyle=t.featureActiveStyle||new i.Style({strokeColor:"#FF0000",lineWeight:1})},setEditVertices:function(){for(var t=this.points,e=t.length,r=this._layer._map,n=[],o=0;o<e-1;o++){var s=t[o],a=t[o+1],l=-1<o-1?o-1:e-1,h=void 0===l?void 0:(t[l].y-a.y)/(t[l].x-a.x);n.push({point:s,sPoint:i.Util.worldToScreen(r,s.x,s.y),type:"formal",index:o,k:h?-1/h:void 0,relationNodesIndex:[l,o+1]});var c={x:(s.x+a.x)/2,y:(s.y+a.y)/2},u=(a.y-s.y)/(a.x-s.x);if(n.push({point:c,sPoint:i.Util.worldToScreen(r,c.x,c.y),type:"tmp",index:o,k:-1/u,relationNodesIndex:[o,o+1]}),o===e-2){var d=(t[0].y-s.y)/(t[0].x-s.x);n.push({point:a,sPoint:i.Util.worldToScreen(r,a.x,a.y),type:"formal",index:o+1,k:d?-1/d:void 0,relationNodesIndex:[o,0]});var y=t[0],f={x:(y.x+a.x)/2,y:(y.y+a.y)/2},p=(t[0].y-a.y)/(t[0].x-a.x);n.push({point:f,sPoint:i.Util.worldToScreen(r,f.x,f.y),type:"tmp",index:o,k:-1/p,relationNodesIndex:[o+1,0]})}}this._editPoints=n},setVerticesActiveStatus:function(){if(this.activeStatus){var t=this._layer._ctx,e=this._layer._map,r=this._editPoints.filter((function(t){return"formal"===t.type})),n=this._editPoints.filter((function(t){return"tmp"===t.type}));t.globalAlpha=1,t.fillStyle="#FF0000",i.Graph.drawGeoPoints(e,t,r.map((function(t){return t.point}))),t.globalAlpha=1,t.fillStyle="#FF9900",i.Graph.drawGeoPoints(e,t,n.map((function(t){return t.point})))}},catchPointWithPos:function(t,e){if(this._layer=t,!this.visible||"point"===this.type)return{flag:!1,point:null};for(var r=this._editPoints,n=this._layer._map,o=i.Util.worldToScreen(n,e.x,e.y),s=r.length,a=0;a<s;a++){var l=r[a].sPoint,h=(o.x-l.x)*(o.x-l.x)+(o.y-l.y)*(o.y-l.y);if(Math.sqrt(h)<=10)return{flag:!0,point:r[a]}}return{flag:!1,point:null}},update:function(t){this.points=t.points?t.points instanceof Array?t.points:[t.points]:this.points,this.data=t.data||this.data,this.style=t.style||this.style,t.points&&this.setEditVertices(),this._layer.renew()},getStyleSize:function(){var t=i.Util.getDpr();return this.style.lineWeight*t}}),i.Marker=e.extend({init:function(t,e){this.id=t,this._img=new Image,this._img.src=e.src,this.src=e.src,this._img.style.position="absolute",this._img.style.zIndex=100,this.info=e},onAdd:function(t){var e=(this._layer=t).getMap(),r=this._container=t.getLayerContainer();this.x=this.info.x,this.y=this.info.y;var n=i.Util.worldToScreen(e,this.info.x,this.info.y);this._img.style.left=n.x+this.info.offset.x+"px",this._img.style.top=n.y+this.info.offset.y+"px",this._img.style.cursor="pointer",r.appendChild(this._img)},onRemove:function(){this._container.removeChild(this._img)},update:function(t){t.src&&(this._img.src=t.src),t.x&&(this.info.x=t.x),t.y&&(this.info.y=t.y),t.offset&&(this.info.offset=t.offset),this.renew()},regEvent:function(t,e){var r=this;"click"===t?(i.Util.addEvtHandler(this._img,"mousedown",(function(t){i.Util.preventDefault(t),i.Util.stopPropagation(t)})),i.Util.addEvtHandler(this._img,"mouseup",(function(t){0===i.Util.getButton(t)&&e.apply(r,arguments),i.Util.preventDefault(t),i.Util.stopPropagation(t)})),i.Util.addEvtHandler(this._img,"click",(function(t){i.Util.preventDefault(t),i.Util.stopPropagation(t)}))):"mouseover"===t?i.Util.addEvtHandler(this._img,"mouseover",(function(t){e.apply(r,arguments),i.Util.preventDefault(t),i.Util.stopPropagation(t)})):"mouseout"===t&&i.Util.addEvtHandler(this._img,"mouseout",(function(t){e.apply(r,arguments),i.Util.preventDefault(t),i.Util.stopPropagation(t)}))},renew:function(){var t=this._layer.getMap(),e=i.Util.worldToScreen(t,this.info.x,this.info.y);this._img.style.left=e.x+this.info.offset.x+"px",this._img.style.top=e.y+this.info.offset.y+"px"},showInfo:function(){console.log("Hello ...")}}),i.Text=e.extend({init:function(t,e,i){this.id=t,this.info=e,this.startPoint=e.pos,this.offset=e.offset||{x:0,y:0},this.maxWidth=void 0,this.visible=![!0,!1].includes(e.visible)||e.visible,(e.width||0===e.width)&&(this.boxWidth=e.width),(e.maxWidth||0===e.maxWidth)&&(this.maxWidth=e.maxWidth),this.padding=1,this.text=e.text,this.data=e.data,this.gStyle=i},onAdd:function(t){this._layerID=t.id,this._layer=t,this.style=this.gStyle||t.textStyle,this.onDraw(t)},update:function(t){t.pos&&(this.startPoint=t.pos),t.offset&&(this.offset=t.offset),t.text&&(this.text=t.text),t.width&&(this.boxWidth=t.width),t.maxWidth&&(this.maxWidth=t.maxWidth),t.style&&(this.style=t.style),this.renew()},show:function(){this.visible=!0,this.renew()},hide:function(){this.visible=!1,this.renew()},onDraw:function(t){var e=this.startPoint,r=this.offset,n=this.style,o=this.text,s=this.maxWidth,a=this.padding,l=n.fontSize,h=n.fontFamily,c=n.fontColor,u=n.bgColor,d=i.Util.getDpr(),y=l*d,f=a*d;if(this.visible&&o){var p=t.getMap(),g=t.getCtx(),v=i.Util.worldToScreen(p,e.x,e.y),x=i.Util.transformScreenXYWithDpr({x:v.x+r.x,y:v.y+r.y}),m=x.x,w=x.y;g.font="".concat(y,"px ").concat(h),g.globalAlpha=1,g.fillStyle=u;var C=g.measureText(o).width+2*f;s&&s*d<C&&(C=s*d+2*f),g.fillRect(m,w,C,y+2*f),g.fillStyle=c,s?g.fillText(o,m+f,w+y-f,s*d):g.fillText(o,m+f,w+y-f)}},setText:function(t){this.text=t,this.refresh()},setPosition:function(t,e){this.startPoint.x=t,this.startPoint.y=e,this.refresh()},setSize:function(t){var e=t.width,i=t.maxWidth;(e||0===e)&&(this.boxWidth=e),(i||0===i)&&(this.maxWidth=i)},onRemove:function(){},renew:function(){this._layer.renew()},refresh:function(){this.renew()}}),i.Text2=e.extend({init:function(t,e,r){this.id=t,this.info=e,this.startPoint=e.pos,this.offset=e.offset||{x:0,y:0},this.boxWidth="auto",this.boxMaxWidth="initial",this.visible=![!0,!1].includes(e.visible)||e.visible,e.width||0===e.width?this.boxWidth=e.width:(e.maxWidth||0===e.maxWidth)&&(this.boxMaxWidth=e.maxWidth),this.wrap=e.wrap||!1,this.text=e.text,this.data=e.data,this.style=r||new i.Style({})},onAdd:function(t){var e=this.id,r=i.Util.createDiv(e,void 0,void 0,!0);r.style.borderWidth=0,this.wrap||(r.style.overflow="hidden",r.style.textOverflow="ellipsis",r.style.whiteSpace="nowrap"),this._textContainer=r,(this._container=t.getLayerContainer()).appendChild(this._textContainer),this._layer=t,this.onDraw(t)},update:function(t){t.pos&&(this.startPoint=t.pos),t.offset&&(this.offset=t.offset),t.text&&(this.text=t.text),t.width&&(this.boxWidth=t.width),t.maxWidth&&(this.boxMaxWidth=t.maxWidth),t.style&&(this.style=t.style),this.renew()},show:function(){this.visible=!0,this.renew()},hide:function(){this.visible=!1,this.renew()},onDraw:function(t){var e=i.Util.worldToScreen(t._map,this.startPoint.x,this.startPoint.y);e.x=e.x+this.offset.x,e.y=e.y+this.offset.y,this._textContainer.style.fontSize=this.style.fontSize+"px",this._textContainer.style.lineHeight=this.style.fontSize+"px",this._textContainer.style.fontFamily=this.style.fontFamily+",SimSun",this._textContainer.style.color=this.style.fontColor,this._textContainer.style.borderRadius="1px",this._textContainer.style.boxSizing="border-box",this._textContainer.style.padding="1px",this._textContainer.style.width="auto"===this.boxWidth?"auto":"".concat(this.boxWidth,"px"),this._textContainer.style.maxWidth="initial"===this.boxMaxWidth?"initial":"".concat(this.boxMaxWidth,"px"),this._textContainer.style.background=this.style.bgColor,this._textContainer.textContent=this.text,this.text&&this.visible?this._textContainer.style.display="block":this._textContainer.style.display="none",this._textContainer.style.left=e.x+"px",this._textContainer.style.top=e.y+"px",t._layerContainer.appendChild(this._textContainer)},setText:function(t){this.text=t,this.refresh()},setPosition:function(t,e){this.startPoint.x=t,this.startPoint.y=e},setSize:function(t){var e=t.width,i=t.maxWidth;(e||0===e)&&(this.boxWidth=e),(i||0===i)&&(this.boxMaxWidth=i)},onRemove:function(){this._container.removeChild(this._textContainer)},getContainer:function(){return this._textContainer},renew:function(){var t=this._layer;this.onDraw(t)},refresh:function(){this.renew()}}),i.Style=e.extend({init:function(t){this.oStyle="singleStyle",this.fillColor=t.fillColor?t.fillColor:"#00DD00",this.strokeColor=t.strokeColor?t.strokeColor:"#00DD00",this.lineWeight=t.lineWeight?t.lineWeight:1,this.borderStatus=!t.borderStatus||t.borderStatus,this.pointRadius=t.pointRadius?t.pointRadius:3,this.cirRadius=t.cirRadius?t.cirRadius:3,this.fillStatus=!t.fillStatus||t.fillStatus,this.vtxStatus=!!t.vtxStatus&&t.vtxStatus,this.vtxRadius=t.vtxRadius?t.vtxRadius:3,this.tlr=t.tlr?t.tlr:5,this.opacity=t.opacity||0===t.opacity?t.opacity:1,this.mappingValue=t.mappingValue?t.mappingValue:"default",this.fontSize=t.fontSize?t.fontSize:13,this.fontFamily=t.fontFamily?t.fontFamily:"KaiTi",this.fontColor=t.fontColor?t.fontColor:"#333333",this.bgColor=t.bgColor?t.bgColor:"#ffffff",this.lineDash=t.lineDash||!1}}),i.StyleEx=e.extend({init:function(t,e){this.oStyle="multiStyles",this.styles=t,this.mappingField=e}}),i.Edit={},i.Edit.mouseDown=function(t,e){var r=i.Util.getMouseXY(t._container,e),n=i.Util.screenToWorld(t,r.x,r.y),o=t.mode;switch(i.Edit.setDrawStyle(t),i.Edit.setDrawMaskStyle(t),o){case"drawPoint":case"drawRect":case"drawPolygon":case"drawPolyline":case"drawRoi":case"drawMask":var s=i.Util.getButton(e),a=t.activeFeature,l=t.hoverFeature;if(a){var h=a.type,c=a.options,u=c&&c.edgeFixed;if("rect"===h)t.dragging=!0;else if("polygon"===h||"polyline"===h||"roi"===h){var d=t.activePoint;if(!u&&d&&"formal"===d.type&&2===s){var y=a.points,f=i.Util.formatGeoPointsWithDeleteIndex(y,t.activePoint.index,"polyline"===h?2:3);t.userGeometryEditDone&&t.userGeometryEditDone(h,a,f)}else t.dragging=!0}}else if(l&&"point"===l.type&&2===s)t.userGeometryRemove&&t.userGeometryRemove("point",l),t.tipLayer.clear();else{var p=t.resetLayerStatus("active"),g=new i.Geometry.Point(n.x,n.y);if(p)return void t.resetLayerStatus("active");"drawPoint"===o&&0===s&&(t.drawGeometryPoints=[],t.drawGeometryPoints.push(g)),"drawRect"===o?t.drawGeometryPoints.push(g):"drawPolygon"===o?(t.tipLayer.setGeoText("ctrl+z撤销",n.x,n.y),t.drawGeometryPoints.push(g)):"drawRoi"===o?(t.tipLayer.setGeoText("ctrl+z撤销",n.x,n.y),t.userFilterRoiArea?t.userFilterRoiArea(g)&&t.drawGeometryPoints.push(g):t.drawGeometryPoints.push(g)):"drawPolyline"===o?(t.tipLayer.setGeoText("ctrl+z撤销",n.x,n.y),t.drawGeometryPoints.push(g)):"drawMask"===o&&i.Edit.storeAndDrawMaskLines(t,n,!0)}break;case"clearMask":i.Edit.storeAndClearMaskLines(t,n,r,!0)}},i.Edit.mouseMove=function(t,e){var r=t.overLayer.getCtx(),n=e.srcElement?i.Util.getMouseXY(t._container,e):e,o=i.Util.screenToWorld(t,n.x,n.y),s=t.mode,l=t.startX,h=t.startY,c=n.x-l,u=n.y-h,d=t.drawGeometryPoints,p=d.length;switch(s){case"drawPoint":case"drawRect":case"drawPolygon":case"drawPolyline":case"drawRoi":case"drawMask":t.overLayer.clear(),t.tipLayer.clear();var g=t.activeFeature,v=t.hoverFeature;if(g){var x=t.activePoint,m=g.points,w=g.type,C=g.options,S=C&&C.edgeFixed;if(t.dragging){t.overLayer.setEditStyle(),t.overLayer.topzIndex();var _=g.getStyleSize();if(r.lineWidth=_,x){var P=[],b=t.activePoint,M=b.type,U=b.relationNodesIndex,T=b.index;if("tmp"===M)if("rect"===w){var k=y(t,c,u);P=i.Util.calRectNewPointsWithNodesIndexTmpPoint(t,m,U,k.dltx,k.dlty)}else"polygon"!==w&&"polyline"!==w&&"roi"!==w||(P=i.Util.calPolygonNewPointsWithNodesIndexTmpPoint(t,m,U[0],o));else if("formal"===M)if("rect"===w){var A=f(t);P=i.Util.calRectNewPointsWithNodesIndexFormalPoint(t,m,U,T,c,u,A.flag)}else"polygon"!==w&&"polyline"!==w&&"roi"!==w||(P=i.Util.calPolygonNewPointsWithNodesIndexFormalPoint(t,m,T,c,u));var I="polyline"===w?"drawLines":"drawPolygon";i.Graph[I](r,P.sPoints),t.withRectCross&&"rect"===w&&i.Graph.drawGeoRectCross(t,r,P.points),t.userGeometryEditing&&t.userGeometryEditing(w,g,P.points)}else{var G=i.Util.formatGeoPointsWithDlt(t,m,c,u),W="polyline"===w?"drawGeoLines":"drawGeoPolygon";i.Graph[W](t,r,G),t.withRectCross&&"rect"===w&&i.Graph.drawGeoRectCross(t,r,G),t.userGeometryEditing&&t.userGeometryEditing(w,g,G)}}else x&&"formal"===x.type&&!S&&(3<m.length&&"polygon"===w||3<m.length&&"roi"===w||2<m.length&&"polyline"===w)&&t.tipLayer.setGeoText("右键删除节点",o.x,o.y)}else if(0<p)if(t.overLayer.topzIndex(),"drawRect"===s){var D=[d[0],{x:o.x,y:d[0].y},o,{x:d[0].x,y:o.y}];i.Graph.drawGeoPolygon(t,r,D),t.withRectCross&&i.Graph.drawGeoRectCross(t,r,D)}else if("drawPolygon"===s||"drawRoi"===s){1<p&&t.tipLayer.setGeoText("双击结束绘制",o.x,o.y);var F=[].concat(a(d),[o]);i.Graph.drawDashGeoPolygon(t,r,F)}else if("drawPolyline"===s){1<=p&&t.tipLayer.setGeoText("双击结束绘制",o.x,o.y);var L=[].concat(a(d),[o]);i.Graph.drawGeoLines(t,r,L)}else"drawMask"===s&&i.Edit.storeAndDrawMaskLines(t,o);else if(v){var z="point"===v.type?"右键删除":"双击选择编辑";t.tipLayer.setGeoText(z,o.x,o.y)}break;case"clearMask":0<p&&i.Edit.storeAndClearMaskLines(t,o,n)}return!0},i.Edit.modeTypeMapping={drawRect:"rect",drawPolygon:"polygon",drawPolyline:"polyline",drawRoi:"roi"},i.Edit.mouseUp=function(t,e){var n=e.srcElement?i.Util.getMouseXY(t._container,e):e,o=i.Util.screenToWorld(t,n.x,n.y),s=t.mode,a=t.startX,l=t.startY,h=n.x-a,c=n.y-l;switch(s){case"drawPoint":case"drawRect":case"drawPolygon":case"drawPolyline":case"drawRoi":case"drawMask":var u=t.activeFeature,d=t.activePoint,p=t.dragging;if(u){var g=u.points,v=u.type;if(p){t.overLayer.clear();var x=[];if(d){var m=d.type,w=d.relationNodesIndex,C=d.index,S=[];if("tmp"===m)if("rect"===v){var _=y(t,h,c);S=i.Util.calRectNewPointsWithNodesIndexTmpPoint(t,g,w,_.dltx,_.dlty)}else"polygon"!==v&&"polyline"!==v&&"roi"!==v||(S=i.Util.calPolygonNewPointsWithNodesIndexTmpPoint(t,g,w[0],o));else if("formal"===m)if("rect"===v){var P=f(t);S=i.Util.calRectNewPointsWithNodesIndexFormalPoint(t,g,w,C,h,c,P.flag)}else"polygon"!==v&&"polyline"!==v&&"roi"!==v||(S=i.Util.calPolygonNewPointsWithNodesIndexFormalPoint(t,g,C,h,c));x=S.points}else x=i.Util.formatGeoPointsWithDlt(t,g,h,c);t.userGeometryEditDone&&t.userGeometryEditDone(v,t.activeFeature,x),t.dragging=!1}}else if(0<t.drawGeometryPoints.length&&"drawPoint"===s){var b=i.Edit.getPointSize(t),M=Math.round(i.Util.screenToWorldDistance(t,b));t.drawGeometryPoints=[t.drawGeometryPoints,0===M?1:M]}else if(0<t.drawGeometryPoints.length&&"drawRect"===s){t.overLayer.clear();var U=t.drawGeometryPoints[0],T=new i.Geometry.Point(o.x,o.y),k=i.Util.getRectPointsWithSAndE(U,T),A=r(k,3),I=A[0],G=A[2];Math.abs(I.x-G.x)<2||Math.abs(I.y-G.y)<2?(t.drawGeometryPoints=[],console.log("invalid points data: 绘制矩形 —— 不是有效矩形框...")):t.drawGeometryPoints=k}else 0<t.drawGeometryPoints.length&&"drawMask"===s&&t.overLayer.clear()}i.Edit.setDrawStyle(t)},i.Edit.mouseDblClick=function(t,e){switch(t.mode){case"drawPoint":case"drawRect":t.tipLayer.clear();break;case"drawPolyline":if(t.overLayer.clear(),t.tipLayer.clear(),t.drawGeometryPoints.pop(),2<=t.drawGeometryPoints.length){var r=i.Edit.getMaskSize(t),n=Math.round(i.Util.screenToWorldDistance(t,r));t.drawGeometryPoints=[t.drawGeometryPoints,0===n?1:n]}else t.drawGeometryPoints=[],console.log("invalid points data: 绘制多段线 —— 不是有效多段线...");break;case"drawRoi":case"drawPolygon":t.overLayer.clear(),t.tipLayer.clear(),t.drawGeometryPoints.pop(),3<=t.drawGeometryPoints.length||(t.drawGeometryPoints=[],console.log("invalid points data: 绘制多边形 —— 不是有效多边形..."));break;case"drawMask":t.overLayer.clear(),t.tipLayer.clear()}},i.Edit.setDrawStyle=function(t){var e=t.overLayer.getCtx();t.globalStyle?i.Util.setStyle(e,t.globalStyle):t.overLayer.setInitStyle()},i.Edit.setDrawMaskStyle=function(t){var e=t.mode,r=t.overLayer.getCtx(),n=i.Edit.getMaskSize(t),o=i.Edit.getMaskColor(t);if("drawMask"===e){var s=i.Util.getDpr();r.lineWidth=n*s,r.strokeStyle=o}},i.Edit.getMaskColor=function(t){var e=t.globalStyle,i=t.overLayer;return e&&e.fillColor?e.fillColor:i.getCtxStyle().fillStyle},i.Edit.getMaskSize=function(t){var e=t.globalStyle,i=t.overLayer;return e&&e.lineWeight?e.lineWeight:i.getCtxStyle().lineWidth},i.Edit.getPointSize=function(t){var e=t.globalStyle;return e&&e.pointRadius?e.pointRadius:3},i.Edit.storeAndDrawMaskLines=function(t,e,r){var n=t.overLayer,o=i.Edit.getMaskSize(t),s=n.getCtx(),a=i.Util.screenToWorldDistance(t,o),l=i.Edit.getMaskColor(t);r&&(t.drawGeometryPoints=[]);var h=!1,c=t.drawGeometryPoints.length;if(c){var u=t.drawGeometryPoints[c-1].point,d=u.x,y=u.y,f=e.x,p=e.y;d===f&&y===p&&(h=!0)}if(!h){var g=i.Edit.getMaskJoinRect(t.drawGeometryPoints,e,a);t.drawGeometryPoints.push({point:e,size:a,color:l,rect:g})}var v=t.drawGeometryPoints.map((function(t){return t.point}));i.Graph.drawGeoLines(t,s,v)},i.Edit.storeAndClearMaskLines=function(t,e,r,n){var o=i.Edit.getMaskSize(t),s=t.getAllLayers(),a=i.Util.screenToWorldDistance(t,o);n&&(t.drawGeometryPoints=[]);var l=!1,h=t.drawGeometryPoints.length;if(h){var c=t.drawGeometryPoints[h-1].point,u=c.x,d=c.y,y=e.x,f=e.y;u===y&&d===f&&(l=!0)}if(!l){var p=i.Edit.getMaskJoinRect(t.drawGeometryPoints,e,a),g={point:e,size:a,rect:p};t.drawGeometryPoints.push(g);for(var v=0,x=s.length;v<x;v++){var m=s[v];"maskLayer"===m.oClass&&(m.clearMaskWithCircleSegment({point:e,radius:a/2}),p&&m.clearMaskWithPolygonSegment({points:p}))}}},i.Edit.getMaskJoinRect=function(t,e,i){var r=t.length;if(r<1)return null;var n=t[r-1].point,o=e,s=o.x-n.x,a=o.y-n.y,l=Math.sqrt(s*s+a*a);if(!l||!i)return null;var h=s/l*i,c=a/l*i;return[{x:n.x-c/2,y:n.y+h/2},{x:o.x-c/2,y:o.y+h/2},{x:o.x+c/2,y:o.y-h/2},{x:n.x+c/2,y:n.y-h/2}]},i.Edit.formatMaskPoints=function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=[],r=0,n=t.length;r<n;r++){var o=t[r],s=o.point,a=o.size,l=o.color,h=o.rect,c=a/2,u={type:"polygon",points:h,bbox:h?i.Util.getBounds(h,"bbox"):[],color:l},d={type:"circle",point:s,radius:c,bbox:[s.x-c,s.y+c,a,a],color:l};h&&e.push(u),e.push(d)}return e},i.Map=e.extend({init:function(t,e){this._options=e||{},this.destroy(t),this.privateInitContainer(t),this.privateInitProp(),this.privateInitEvent(),this.overLayer=new i.Layer.Overlay("overlay"),this.tipLayer=new i.Layer.Tip("tip"),this.mLayer=new i.Layer.Marker("markerLayer"),this.addLayer(this.overLayer),this.addLayer(this.tipLayer),this.addLayer(this.mLayer),this.attachEvents(),this.attachSlots(),this.registerShortKeyEvent()},attachEvents:function(){var t=this;t.events={on:function(e,i){switch(e){case"boundsChanged":t.userBoundsChanged=function(){i()};break;case"mouseDown":t.userMouseDown=function(t){var e=i(t);return"boolean"!=typeof e||e};break;case"mouseMove":t.userMouseMove=function(t){i(t)};break;case"geometryEditing":t.userGeometryEditing=function(t,e,r){i(t,e,r)};break;case"geometryEditDone":t.userGeometryEditDone=function(t,e,r){i(t,e,r)};break;case"geometryRemove":t.userGeometryRemove=function(t,e){i(t,e)};break;case"geometryDrawDone":t.userGeometryDrawDone=function(t,e,r){i(t,e,r)};break;case"featureHover":t.userFetureHover=function(t,e,r){i(t,e,r)};break;case"featureSelected":t.userFetureSelected=function(t,e,r){i(t,e,r)};break;case"featureWillSelected":t.userFetureWillSelected=function(t,e,r){i(t,e,r)};break;case"featureStatusReset":t.userFeatureStatusReset=function(t){i(t)};break;case"resize":t.userGMapResize=function(){i()}}}}},attachSlots:function(){var t=this;t.slots={on:function(e,i){switch(e){case"coordsTransformBeforeGeometryDrawDone":t.userCoordsTransformBeforeGeometryDrawDone=function(t,e){return i(t,e)||t};break;case"coordsTransformBeforeRender":t.userCoordsTransformBeforeRender=function(t,e){return i(t,e)||t};break;case"filterRoiArea":t.userFilterRoiArea=function(t){return i(t)}}},off:function(e){switch(e){case"coordsTransformBeforeGeometryDrawDone":t.userCoordsTransformBeforeGeometryDrawDone=null;break;case"coordsTransformBeforeRender":t.userCoordsTransformBeforeRender=null}}}},onBoundsChanged:function(){for(var t=this.getAllControls(),e=0;e<t.length;e++)t[e].boundsWatch();this.userBoundsChanged&&this.userBoundsChanged()},registerShortKeyEvent:function(){var t=this;i.Util.Key.addEventListener([17,90],(function(){-1<["drawPolygon","drawPolyline","drawRoi"].indexOf(t.mode)&&t.drawGeometryPoints.length&&(t.drawGeometryPoints.pop(),i.Edit.mouseMove(t,{x:t.middleX,y:t.middleY}))}))},handleWindowResize:function(){var t=this._containerSize,e=t.clientWidth,i=t.clientHeight,r=this._container,n=r.clientWidth,o=r.clientHeight;e===n&&i===o||this.resize()},privateInitContainer:function(t){if(this._container=document.getElementById(t),this._container){this._container.innerHTML="",this.w=this._options.w||this._container.clientWidth,this.h=this._options.h||this._container.clientHeight,this._container.style.overflow="hidden",this._container.style.userSelect="none",this._container.oncontextmenu=function(){return!1};var e=this._container,i=e.clientWidth,r=e.clientHeight;this._containerSize={clientWidth:i,clientHeight:r},window.addEventListener("resize",this.handleWindowResize.bind(this))}},getContainer:function(){return this._container},getSize:function(){return{w:this.w,h:this.h}},privateInitProp:function(){this.mode="pan",this.panConfig={zoom:!0},this.dragging=!1,this.autoPanTimer=null,this.autoPanFlag=!(0<=[!0,!1].indexOf(this._options.autoPan))||this._options.autoPan,this.drawZoomFlag=!(0<=[!0,!1].indexOf(this._options.drawZoom))||this._options.drawZoom,this.autoFeatureSelect=!(0<=[!0,!1].indexOf(this._options.autoFeatureSelect))||this._options.autoFeatureSelect,this.oLayers=[],this.oControls=[],this.zoom=this._options.zoom||parseInt(1*this.w,10),this.cx=this._options.cx||0,this.cy=this._options.cy||0,this.startX=0,this.startY=0,this.startScrX=0,this.startSrcY=0,this.middleX=0,this.middleY=0,this.moveWxy=null,this.zoomScale=.025,this.zoomMax=this._options.zoomMax||1e9,this.zoomMin=this._options.zoomMin||0,this.mouseWheelZoomRatio=this._options.mouseWheelZoomRatio||1,this.drawGeometryPoints=[],this.activeFeature=null,this.activePoint=null,this.withRectCross=!1,this.maskBounds=null,this.drawPointTimer=null},mapMouseDownForPan:function(t){this.dragging=!0;for(var e=this.getAllLayers(),r=0;r<e.length;r++)e[r].startLeft=i.Util.delpx(e[r]._layerContainer.style.left),e[r].startTop=i.Util.delpx(e[r]._layerContainer.style.top)},mapMouseMoveForPan:function(t){var e=i.Util.getMousePos(t);if(this.dragging){var r=e.x-this.startScrX,n=e.y-this.startScrY,o=this.getAllLayers();if(0<Math.abs(r)||0<Math.abs(n))for(var s=0;s<o.length;s++)o[s].onDrag(r,n)}},mapMouseUpForPan:function(t){var e=i.Util.getMousePos(t),r=e.x-this.startScrX,n=e.y-this.startScrY;if(0<Math.abs(r)||0<Math.abs(n)){var o=this.getScreenCenter(),s=o.x-r,a=o.y-n,l=i.Util.screenToWorld(this,s,a);this.setCenter(l.x,l.y)}this.dragging=!1},mapMouseMoveForEdit:function(t){var e=this,r=i.Util.getMouseXY(this._container,t);-1<["drawPolygon","drawRect","drawPolyline","drawRoi"].indexOf(this.mode)&&0<this.drawGeometryPoints.length&&(r.x<=10||r.y<=10||r.x>=this.w-10||r.y>=this.h-10)&&!this.autoPanTimer&&this.autoPanFlag?this.autoPanTimer=window.setInterval((function(){return e.mapAutoPanForEdit({left:r.x<=10,right:r.x>=e.w-10,top:r.y<=10,bottom:r.y>=e.h-10})}),0):this.autoPanTimer&&(window.clearInterval(this.autoPanTimer),this.autoPanTimer=null),i.Edit.mouseMove(this,t)},mapAutoPanForEdit:function(t){var e=t.left,r=t.right,n=t.top,o=t.bottom,s=this.getScreenCenter(),a=e?-.2:r?.2:0,l=n?-.2:o?.2:0,h=s.x+a,c=s.y+l,u=i.Util.screenToWorld(this,h,c);this.setCenter(u.x,u.y)},coordsTransformBatch:function(t,e,i){var r=this;return this[t]?e.map((function(e){return r[t](e,i)})):e},mapMouseUpForEdit:function(t){var e=this;i.Edit.mouseUp(this,t||{x:0,y:0});var n=this.drawGeometryPoints.length;if(this.overLayer.resetzIndex(),n)switch(this.mode){case"drawPoint":this.clearDrawPointTimer(),this.drawPointTimer=setTimeout((function(){var t=r(e.drawGeometryPoints,2),i=t[0],n=t[1];e.userGeometryDrawDone&&i.length&&e.userGeometryDrawDone("point",i[0],{radius:n}),e.drawGeometryPoints=[],e.clearDrawPointTimer()}),200);break;case"drawRect":this.userGeometryDrawDone&&this.userGeometryDrawDone("rect",this.drawGeometryPoints),this.drawGeometryPoints=[];break;case"drawPolygon":case"drawRoi":case"drawPolyline":break;case"drawMask":var o=i.Edit.formatMaskPoints(this.drawGeometryPoints,"draw");this.userGeometryDrawDone&&o&&o.length&&this.userGeometryDrawDone("mask",{key:"".concat((new Date).getTime()),type:"drawMask",segments:o}),this.drawGeometryPoints=[];break;case"clearMask":var s=i.Edit.formatMaskPoints(this.drawGeometryPoints,"clear");this.userGeometryDrawDone&&s&&s.length&&this.userGeometryDrawDone("mask",{key:"".concat((new Date).getTime()),type:"clearMask",segments:s}),this.drawGeometryPoints=[]}},clearDrawPointTimer:function(){this.drawPointTimer&&(clearTimeout(this.drawPointTimer),this.drawPointTimer=null)},privateInitEvent:function(){var t=this,e=this._container;function n(e){var r=e||window.event;window.event||r.preventDefault();var n=i.Util.getMouseXY(t._container,r),o=i.Util.screenToWorld(t,n.x,n.y),s=i.Util.getMousePos(r);t.startX=n.x,t.startY=n.y,t.startScrX=s.x,t.startScrY=s.y,"pan"===t.mode?(t.resetLayerStatus("active"),t.mapMouseDownForPan(r),document.onmousemove=function(e){t.mapMouseMoveForPan(e)},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null,t.mapMouseUpForPan(e)}):("drawMask"!==t.mode&&"clearMask"!==t.mode||(document.onmouseup=function(e){document.onmouseup=null,t.fromContainerUp||(console.log("document up：should do sth"),t.mapMouseUpForEdit()),t.fromContainerUp=!1}),i.Edit.mouseDown(t,r)),t.userMouseDown&&t.userMouseDown(o)}function o(e){var r=i.Util.getMouseXY(t._container,e),n=i.Util.screenToWorld(t,r.x,r.y);t.middleX=r.x,t.middleY=r.y,t.moveWxy=n,t.mapMouseMoveForEdit(e),!t.dragging&&t.handleDrawEditGeometryMouseMove(n),t.userMouseMove&&t.userMouseMove(n),!t.dragging&&t.setTargets(e,n,"hover")}function s(e){t.fromContainerUp=!0,t.mapMouseUpForEdit(e)}function a(e){t.clearDrawPointTimer(),"drawPoint"===t.mode&&(t.drawGeometryPoints=[]);var n=i.Util.getMouseXY(t._container,e),o=i.Util.screenToWorld(t,n.x,n.y);if(i.Edit.mouseDblClick(t,e),t.drawGeometryPoints.length)switch(t.mode){case"drawPoint":case"drawRect":break;case"drawPolygon":case"drawRoi":t.userGeometryDrawDone&&t.userGeometryDrawDone("drawPolygon"===t.mode?"polygon":"roi",t.drawGeometryPoints),t.drawGeometryPoints=[];break;case"drawPolyline":var s=r(t.drawGeometryPoints,2),a=s[0],l=s[1];t.userGeometryDrawDone&&t.userGeometryDrawDone("polyline",a,{width:l}),t.drawGeometryPoints=[]}else switch(t.mode){case"drawPoint":case"drawRect":case"drawPolygon":case"drawRoi":case"drawPolyline":case"drawMask":!t.activeFeature&&t.setTargets(e,o,"selected")}}function l(e){var r=t.drawZoomFlag,n=t.mode,o=t.panConfig,s="pan"===n&&o.zoom,a=-1<["drawPolygon","drawRoi","drawPoint","drawPolyline","drawRect","drawMask","clearMask"].indexOf(n),l=r&&a&&o.zoom,h=i.Util.getMouseXY(t._container,e),c=i.Util.screenToWorld(t,h.x,h.y);if(a&&t.drawGeometryPoints.length&&i.Edit.mouseMove(t,{x:h.x,y:h.y}),s||l)if(i.Util.preventDefault(e),0<(e.wheelDelta||-e.detail)){var u=t.mouseWheelZoomRatio,d=t.getNewZoom("zoomIn",u);if(t.zoom<=t.zoomMin||d<=t.zoomMin)return;var y=(c.x-t.cx)*(1-t.zoomScale*u),f=(c.y-t.cy)*(1-t.zoomScale*u),p=c.x-y,g=c.y-f;t.setCenter(p,g,!0),t.zoomIn(u,"mouseWheel")}else{var v=t.mouseWheelZoomRatio,x=t.getNewZoom("zoomOut",v);if(t.zoom>=t.zoomMax||x>=t.zoomMax)return;var m=(c.x-t.cx)/(1-t.zoomScale*v),w=(c.y-t.cy)/(1-t.zoomScale*v),C=c.x-m,S=c.y-w;t.setCenter(C,S,!0),t.zoomOut(v,"mouseWheel")}}i.Util.addEvtHandler(e,"mousedown",n),i.Util.addEvtHandler(e,"mousemove",o),i.Util.addEvtHandler(e,"mouseup",s),i.Util.addEvtHandler(e,"mousewheel",l),i.Util.addEvtHandler(e,"dblclick",a),this._mapMouseDown=n,this._mapMouseMove=o,this._mapMouseUp=s,this._mapMouseDblClick=a,this._mapMouseWheel=l},handleDrawEditGeometryMouseMove:function(t){var e=this;if(t)switch(e.mode){case"pan":e.setCursor("pointer");break;case"clearMask":e.setCursor("cell");break;case"drawPoint":case"drawRect":case"drawPolyline":case"drawMask":case"drawRoi":case"drawPolygon":if(function(){for(var i=e.getAllLayers(),r=0;r<i.length;r++)if("featureLayer"===i[r].oClass||"roiLayer"===i[r].oClass){var n=i[r].catchFeaturePointWithPos(t,"active");if(n.length)return e.activeFeature=n[0].feature,e.activePoint=n[0].point,!(e.hoverFeature=null);var o=i[r].getFeaturesWithPos(t,"active");if(o.length)return e.activeFeature=o[0],e.activePoint=null,!(e.hoverFeature=null);var s=i[r].getFeaturesWithPos(t,"hover");if(s.length)return e.activeFeature=null,e.activePoint=null,e.hoverFeature=s[0],!1}return e.activeFeature=null,e.activePoint=null,e.hoverFeature=null,!1}()){var i=e.activeFeature;if(e.activePoint&&"rect"===i.type){var r=e.activePoint.k;0<r&&r!==1/0?e.setCursor("nesw-resize"):0===r?e.setCursor("ew-resize"):r<0&&r!==-1/0?e.setCursor("nwse-resize"):e.setCursor("ns-resize")}else e.activePoint&&"polygon"===i.type||e.activePoint&&"roi"===i.type||e.activePoint&&"polyline"===i.type?e.setCursor("no-drop"):e.setCursor("move")}else e.setCursor("crosshair")}},setTargets:function(t,e,i){for(var r=this.getAllLayers(),n=[],o=0;o<r.length;o++)n=n.concat(r[o].getFeaturesWithPos(e));var s=this.getTargetFeature(n);if("selected"===i){if(!n.length)return void this.resetLayerStatus("active");if("point"===s.type)return;this.autoFeatureSelect&&s.active(),this.handleDrawEditGeometryMouseMove(e),this.autoFeatureSelect&&this.userFetureSelected&&this.userFetureSelected(s,t,e),!this.autoFeatureSelect&&this.userFetureWillSelected&&this.userFetureWillSelected(s,t,e)}else"hover"===i&&(this.resetLayerStatus("hover"),n.length&&s.hover(),this.userFetureHover&&this.userFetureHover(s,t,e));return this},resetLayerStatus:function(t){for(var e=this.getAllLayers(),i=!1,r=0;r<e.length;r++)"featureLayer"!==e[r].oClass&&"roiLayer"!==e[r].oClass||e[r].resetFeatureStatus(t)&&(i=!0);return t&&"active"===t&&i&&this.userFeatureStatusReset&&this.userFeatureStatusReset(),i},addLayer:function(t){var e=this.oLayers;i.Util.isObjInArray(e,t)||(t.onAdd(this),e.push(t))},removeLayer:function(t){for(var e=[],i=this.oLayers,r=0,n=0;r<i.length;r++)i[r]!==t?(e[n]=i[r],n++):t.onRemove(this);this.oLayers=e},getAllLayers:function(){return this.oLayers},getLayerById:function(t){for(var e=0,i=this.oLayers.length;e<i;e++){var r=this.oLayers[e];if(r.id===t)return r}return null},addControl:function(t){var e=this.oControls;i.Util.isObjInArray(e,t)||(t.onAdd(this),e.push(t))},removeControl:function(t){for(var e=[],i=this.oControls,r=0,n=0;r<i.length;r++)i[r]!==t?(e[n]=i[r],n++):t.onRemove(this);this.oControls=e},getAllControls:function(){return this.oControls},getNewZoom:function(t,e){for(var i=e||6,r=this.zoom;0<i;)"zoomIn"===t?r-=r*this.zoomScale:r/=1-this.zoomScale,i--;return r},getZoom:function(){return this.zoom},setZoom:function(t,e){this.zoom=t,!e&&this.refresh()},zoomIn:function(t,e){var i=this.getNewZoom("zoomIn",t);if(!(this.zoom<=this.zoomMin||i<=this.zoomMin)){var r=this.getAllLayers();this.zoom=i;for(var n=0;n<r.length;n++)r[n].zoomIn(e);this.onBoundsChanged()}},zoomOut:function(t,e){var i=this.getNewZoom("zoomOut",t);if(!(this.zoom>=this.zoomMax||i>=this.zoomMax)){var r=this.getAllLayers();this.zoom=i;for(var n=0;n<r.length;n++)r[n].zoomOut(e);this.onBoundsChanged()}},setMouseWheelZoomRatio:function(t){i.Util.isInteger(t),1<=t&&t<=5&&(this.mouseWheelZoomRatio=t)},setMode:function(t,e){var r=e instanceof i.Style;switch(this.mode=t,this.drawGeometryPoints=[],t){case"pan":this.resetLayerStatus(),!r&&e&&(this.panConfig=Object.assign({},this.panConfig,e))}r&&(this.globalStyle=e)},setGlobalStyle:function(t){t&&(this.globalStyle=t)},setPanConfig:function(t){this.panConfig=Object.assign({},this.panConfig,t||{})},setMaskBounds:function(t,e,i,r){this.maskBounds=[t,e,i,r]},setCursor:function(t){var e=this._container.style.cursor;e!==t&&(this.previousCursor=e,this._container.style.cursor=t)},resetCursor:function(){this.setCursor(this.previousCursor)},setRectCross:function(t){this.withRectCross=!!t},getMode:function(){return this.mode},setCenter:function(t,e,i){this.cx=t,this.cy=e,!i&&this.refresh()},centerAndZoom:function(t,e){this.setCenter(t.x,t.y,!0),this.setZoom(e,!0);for(var i=this.getAllLayers(),r=0;r<i.length;r++)i[r].zoomIn();this.onBoundsChanged()},getCenter:function(){return{x:this.cx,y:this.cy}},getScreenCenter:function(){return{x:this.w/2,y:this.h/2}},resize:function(t,e){var i=this.zoom/this.w,r=t||this._container.clientWidth,n=e||this._container.clientHeight;this.zoom=i*r,this.w=r,this.h=n;for(var o=this.getAllLayers(),s=0;s<o.length;s++)o[s].resize();for(var a=this.getAllControls(),l=0;l<a.length;l++)a[l].resize();this.userGMapResize&&this.userGMapResize(this),this.onBoundsChanged()},refresh:function(){for(var t=this.getAllLayers(),e=0,i=t.length;e<i;e++)t[e].renew();this.onBoundsChanged()},destroy:function(t){var e=t?document.getElementById(t):this._container;e.innerHTML="",i.Util.removeEvtHandler(e,"mousedown"),i.Util.removeEvtHandler(e,"mousemove"),i.Util.removeEvtHandler(e,"mouseup"),i.Util.removeEvtHandler(e,"mousewheel"),i.Util.removeEvtHandler(e,"dblclick"),window.removeEventListener("resize",this.handleWindowResize.bind(this))},getTargetFeature:function(t){if(!t.length)return null;var e=[],r=[],n=[],o=[];return t.forEach((function(t){"point"===t.type&&e.push(t),"polyline"===t.type&&r.push(t),("rect"===t.type||"polygon"===t.type)&&n.push(t),("roi"===t.roiType||"notRoi"===t.roiType)&&o.push(t)})),e.length?e[0]:r.length?r[0]:n.length?n.sort((function(t,e){return i.Util.polygonArea(t.points)-i.Util.polygonArea(e.points)}))[0]:o.length?o[0]:void 0}}),i.Layer=e.extend({init:function(t,e){this.id=t,this.visible=!0,this.options=e||{opacity:1,zIndex:0}},onAdd:function(t){this._map=t,this._container=t.getContainer();var e=t.getSize();this.privateInitLayerContainer(this.id,e.w,e.h),this.privateInitProp(t),this.privateInitParams(t),this._container.appendChild(this._layerContainer),this.setzIndex(),this.setOpacity(this.options.opacity)},onRemove:function(t){t.getContainer().removeChild(this._layerContainer)},privateInitProp:function(t){},privateInitParams:function(t){},onDrag:function(t,e){this._layerContainer.style.left=this.startLeft+t+"px",this._layerContainer.style.top=this.startTop+e+"px"},zoomIn:function(t){this.renew(t)},zoomOut:function(t){this.renew(t)},zoomTo:function(){this.renew()},renew:function(){this._layerContainer.style.left="0px",this._layerContainer.style.top="0px"},getSize:function(){return{w:this._layerContainer.clientWidth,h:this._layerContainer.clientHeight}},getScreenCenter:function(){return{x:parseInt(this._layerContainer.clientWidth/2,10),y:parseInt(this._layerContainer.clientHeight/2,10)}},getMap:function(){return this._map},getLayerContainer:function(){return this._layerContainer},setzIndex:function(){isNaN(this.options.zIndex)||(this._layerContainer.style.zIndex=this.options.zIndex)},setOpacity:function(t){this.getLayerContainer().style.opacity=t},resize:function(){this._layerContainer.style.width=this._map.w+"px",this._layerContainer.style.height=this._map.h+"px"},getFeaturesWithPos:function(t){return[]},deSelect:function(){}}),i.Layer.Image=i.Layer.extend({init:function(t,e,i,r){this._super(t,r),this._src=e,this._size=i,this.oClass="imgLayer",this.setGridInfo(r.grid)},setGridInfo:function(t){this._gridVisible=!0,this._lineClassName="layer-img-line",this._gridConfig=!!t&&Object.assign({},{rowCount:3,columnCount:3,color:"#000"},this._gridConfig||{},t),this._rowLineProps={position:"absolute",boxSizing:"border-box",height:"1px",width:"100%",left:0,borderTop:"1px solid "+this._gridConfig.color},this._columnLineProps={position:"absolute",boxSizing:"border-box",height:"100%",width:"1px",top:0,borderLeft:"1px solid "+this._gridConfig.color}},privateInitParams:function(t){},privateInitProp:function(t){var e=this;this._super(),this._mapImg||(this._mapImg=new Image),this._mapImg.style.position="absolute",this._mapImg.style.left=0,this._mapImg.style.top=0,this._mapImg.src=this._src,this._mapImg.style.width="100%",this._mapImg.style.height="100%",this._mapImg.onmousedown=function(t){t.preventDefault()},this._mapImg.onload=function(){e.setInnerContainerSize()},this._innerContainerId=this.id+"-inner-container",this._innerContainer=document.createElement("div"),this._innerContainer.id=this._innerContainerId,this._innerContainer.appendChild(this._mapImg),this._innerContainer.style.position="absolute",this._layerContainer.appendChild(this._innerContainer),this.renew()},privateInitLayerContainer:function(t,e,r){var n=i.Util.createDiv(t,e,r,!0);n.style.zIndex=2,this._layerContainer=n},onAdd:function(t){this._super(t),this.setGrid()},zoomTo:function(){},setGrid:function(){var t=this._gridConfig||{},e=t.columnCount,i=void 0===e?0:e,r=t.rowCount,n=void 0===r?0:r;if(this.removeGrid(),this._gridConfig&&this._gridVisible){for(var o=parseInt(100/n*100,10)/100,s=parseInt(100/i*100,10)/100,a=0;a<n-1;a++){var l=document.createElement("div");for(var h in l.className=this._lineClassName,this._rowLineProps)l.style[h]=this._rowLineProps[h];l.style.top=(a+1)*o+"%",this._innerContainer.appendChild(l)}for(var c=0;c<i-1;c++){var u=document.createElement("div");for(var d in u.className=this._lineClassName,this._columnLineProps)u.style[d]=this._columnLineProps[d];u.style.left=(c+1)*s+"%",this._innerContainer.appendChild(u)}}},operateGrid:function(t){var e=document.getElementById(this._innerContainerId);if(e)for(var i=e.getElementsByClassName(this._lineClassName),r=i.length-1;0<=r;r--)"remove"===t&&i[r].remove(),"show"===t&&(i[r].style.display="block"),"hide"===t&&(i[r].style.display="none")},removeGrid:function(){this.operateGrid("remove")},showGrid:function(){this.operateGrid("show")},hideGrid:function(){this.operateGrid("hide")},update:function(t){t&&t.grid&&(this.setGridInfo(t.grid),this.setGrid())},renew:function(){this._super(),this.setInnerContainerSize();var t=i.Util.worldToScreen(this._map,-1*this._size.w/2,this._size.h/2);this._innerContainer.style.left=t.x+"px",this._innerContainer.style.top=t.y+"px"},setInnerContainerSize:function(){var t=this._map.getSize(),e=this._map.zoom/t.w;this._innerContainer.style.width=this._size.w/e+"px",this._innerContainer.style.height=this._size.h/e+"px"},resize:function(){this._super(),this.renew()},refresh:function(){}}),i.Layer.Feature=i.Layer.extend({init:function(t,e){e=e||{},this._super(t,e),this.featureStyle=e.style||new i.Style({}),this.featureHoverStyle=e.hoverStyle||new i.Style({strokeColor:"#FF0000",lineWeight:1}),this.featureActiveStyle=e.activeStyle||new i.Style({strokeColor:"#FF0000",lineWeight:1}),this._opacity=!!e.transparent&&e.transparent,this.editable=!0,this.oClass="featureLayer"},privateInitLayerContainer:function(t,e,r){var n=i.Util.createCanvas(t,e,r,!0);this._layerContainer=n,this._ctx=n.getContext("2d"),this._layerContainer.style.left="0",this._layerContainer.style.top="0"},privateInitProp:function(t){this._super()},setEditable:function(t){this.editable=!!t},onAdd:function(t){var e=(this._map=t).getSize(),i=this._map.getContainer();this.privateInitLayerContainer(this.id,e.w,e.h),i.appendChild(this._layerContainer),this.setzIndex(),this.oFeatures=[]},addFeature:function(t){var e=this.getAllFeatures();i.Util.isInArray(e,t)||(e.push(t),t.onAdd(this)),this.triggerFeaturesChange()},getFeatureById:function(t){for(var e=this.getAllFeatures(),i=e.length-1;0<=i;i--)if(e[i].id===t)return e[i];return null},getFeaturesWithPos:function(t,e){if(!this.editable)return[];for(var i=[],r=this.getAllFeatures(),n=r.length-1;0<=n;n--){var o=r[n],s=!0;e&&"active"===e&&(s=o.activeStatus),e&&"hover"===e&&(s=!0),o.isCaught(t)&&s&&i.push(o)}return i},catchFeaturePointWithPos:function(t,e){for(var i=[],r=this.getAllFeatures(),n=r.length-1;0<=n;n--){var o=r[n],s=!0;e&&"active"===e&&(s=o.activeStatus);var a=o.catchPointWithPos(t);a.flag&&s&&i.push({feature:o,point:a.point})}return i},resetFeatureStatus:function(t){for(var e=this.getAllFeatures(),i=!1,r=e.length-1;0<=r;r--){var n=e[r];t&&"active"===t?n.activeStatus&&(i=!(n.activeStatus=!1)):t&&"hover"===t?n.hoverStatus&&(i=!(n.hoverStatus=!1)):(n.activeStatus||n.hoverStatus)&&(n.activeStatus=!1,i=!(n.hoverStatus=!1))}return i&&this.renew(),i},getActiveFeatures:function(){for(var t=[],e=this.getAllFeatures(),i=e.length-1;0<=i;i--)e[i].activeStatus&&t.push(e[i]);return t},getHoverFeatures:function(){for(var t=[],e=this.getAllFeatures(),i=e.length-1;0<=i;i--)e[i].hoverStatus&&t.push(e[i]);return t},removeAllFeatures:function(){this.oFeatures=[],this.renew(),this.triggerFeaturesChange()},removeFeature:function(t){for(var e=[],i=0,r=0;i<this.oFeatures.length;i++)this.oFeatures[i]!==t?(e[r]=this.oFeatures[i],r++):t.onRemove(this);this.oFeatures=e,this.renew(),this.triggerFeaturesChange()},removeFeatureById:function(t){for(var e=[],i=0,r=this.oFeatures.length;i<r;i++){var n=this.oFeatures[i];n.id!==t?e.push(n):n.onRemove(this)}this.oFeatures=e,this.renew(),this.triggerFeaturesChange()},removeFeaturesByIds:function(t){for(var e=[],i=[],r=0,n=this.oFeatures.length;r<n;r++){var o=this.oFeatures[r];-1===t.indexOf(o.id)?e.push(o):(o.onRemove(this),i.push(o))}return this.oFeatures=e,this.renew(),this.triggerFeaturesChange(),i},removeFeaturesByProperty:function(t){for(var e=[],i=[],r=0,n=this.oFeatures.length;r<n;r++){for(var o=this.oFeatures[r],s=!1,a=0,l=t.length;a<l;a++){var h=t[a];if(o.data[h.key]===h.value){s=!0,o.onRemove(this),i.push(o);break}}s||e.push(o)}return this.oFeatures=e,this.renew(),this.triggerFeaturesChange(),i},triggerFeaturesChange:function(){},draw:function(){this.clear();for(var t=this.getAllFeatures(),e=0;e<t.length;e++)t[e].onDraw(this)},renew2:function(){this._super(),this.clear(),this.draw()},renew:function(t){this._super(),this.clear(),"mouseWheel"===t?this.drawTimer():this.draw()},drawTimer:function(){this._drawTimer&&(clearTimeout(this._drawTimer),this._drawTimer=null);var t=this;this._drawTimer=setTimeout((function(){t.draw()}),333)},resize:function(){this._super();var t=i.Util.getDpr();this._layerContainer.width=this._map.w*t,this._layerContainer.height=this._map.h*t,this.renew()},clear:function(){var t=this.getLayerContainer();this._ctx.clearRect(0,0,t.width,t.height)},getAllFeatures:function(){return this.oFeatures},getCtx:function(){return this._ctx}}),i.Layer.Overlay=i.Layer.Feature.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:10},this.zIndexTopFlag=!1,this.oClass="overlayLayer"},setStyle:function(t){this.style=t},initStyle:function(){this.setInitStyle(),this._layerContainer.style.left="0",this._layerContainer.style.top="0"},setInitStyle:function(){var t=this.getCtx(),e=i.Util.getDpr();t.strokeStyle="#0000FF",t.fillStyle="#0000FF",t.lineWidth=1*e,t.globalAlpha=.7},getCtxStyle:function(){var t=this.getCtx();return{strokeStyle:t.strokeStyle,fillStyle:t.fillStyle}},setEditStyle:function(){var t=this.getCtx(),e=i.Util.getDpr();t.strokeStyle="#FF0000",t.lineWidth=1*e,t.globalAlpha=.7},onAdd:function(t){this._super(t),this.initStyle()},resize:function(){this._super();var t=i.Util.getDpr();this._layerContainer.width=this._map.w*t,this._layerContainer.height=this._map.h*t,this.renew()},topzIndex:function(){this.zIndexTopFlag||(this._layerContainer.style.zIndex=9999,this.zIndexTopFlag=!0)},resetzIndex:function(){this.zIndexTopFlag&&(this._layerContainer.style.zIndex=this.options.zIndex,this.zIndexTopFlag=!1)}}),i.Layer.Tip=i.Layer.Feature.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:11},this.tipsVisible=!0,this.oClass="tipLayer"},setStyle:function(t){this.style=t},initStyle:function(){this.setInitStyle(),this._layerContainer.style.left="0",this._layerContainer.style.top="0"},setInitStyle:function(){var t=this.getCtx(),e=12*i.Util.getDpr();t.font="".concat(e,"px Arial"),t.textAlign="left",t.textBaseline="bottom",t.fillStyle="#fff",t.globalAlpha=1},onAdd:function(t){this._super(t),this.initStyle()},resize:function(){this._super();var t=i.Util.getDpr();this._layerContainer.width=this._map.w*t,this._layerContainer.height=this._map.h*t,this.renew()},showTips:function(){this.tipsVisible=!0},hideTips:function(){this.tipsVisible=!1,this.clear()},setTextBackground:function(t,e,i,r){var n=this.getCtx();n.beginPath(),n.rect(t,e,i,r),n.fillStyle="#333",n.fill(),n.lineWidth=1,n.strokeStyle="#efefef",n.stroke()},setText:function(t,e,r){if(this.clear(),t&&this.tipsVisible){var n=this.getCtx(),o=n.measureText(t).width,s=i.Util.transformScreenXYWithDpr({x:e||0,y:r||0}),a=i.Util.getDpr();this.setTextBackground(s.x+4*a,s.y-16*a,o+7*a,20*a),this.setInitStyle(),n.fillText(t,s.x+7*a,s.y+1*a)}},setGeoText:function(t,e,r){if(this.clear(),t&&this.tipsVisible){var n=this.getCtx(),o=n.measureText(t).width,s=i.Util.worldToScreen(this._map,e||0,r||0),a=i.Util.transformScreenXYWithDpr(s),l=i.Util.getDpr();this.setTextBackground(a.x+4*l,a.y-16*l,o+7*l,20*l),this.setInitStyle(),n.fillText(t,a.x+7*l,a.y+1*l)}}}),i.Layer.Mask=i.Layer.extend({init:function(t,e){e=e||{},this._super(t,e),this._opacity=!!e.transparent&&e.transparent,this.oClass="maskLayer",this._actionRelations={},this._roi=[]},privateInitLayerContainer:function(t,e,r){var n=i.Util.createCanvas(t,e,r,!0);this._layerContainer=n,this._ctx=n.getContext("2d"),this._layerContainer.style.left="0",this._layerContainer.style.top="0"},onAdd:function(t){var e=(this._map=t).getSize(),i=this._map.getContainer();this.privateInitLayerContainer(this.id,e.w,e.h),i.appendChild(this._layerContainer),this.setzIndex(),this.setOpacity(this.options.opacity),this.oMaskActions=[]},addMaskAction:function(t,e){e&&(this.clear(),this.oMaskActions=[]),t instanceof Array?this.oMaskActions=[].concat(a(this.oMaskActions),a(t)):this.oMaskActions.push(t),this.updateMaskActionRelation(),this.draw()},updateMaskActionRelation:function(){for(var t=this.oMaskActions,e={},i={},r=0,n=t.length;r<n;r++){var o=t[r],s=o.key,a=o.type,l=o.name;if(("drawMask"===a||"imgMask"===a)&&!e[s]){for(var h=[],c=r+1;c<n;c++){var u=t[c],d=u.key,y=u.type,f=u.name;"drawMask"!==y&&"imgMask"!==y||!f||f!==l||(h.push(u),e[d]=1),"clearMask"===y&&h.push(u)}i[l||s]={targetAction:o,relatedMaskActions:h}}}this._actionRelations=i},renew:function(t){this._super(),this.clear(),"mouseWheel"===t?this.drawTimer():this.draw()},resize:function(){this._super();var t=i.Util.getDpr();this._layerContainer.width=this._map.w*t,this._layerContainer.height=this._map.h*t,this.renew()},clear:function(){var t=this.getLayerContainer();this._ctx.clearRect(0,0,t.width,t.height)},getAllMaskActions:function(){return this.oMaskActions},getCtx:function(){return this._ctx},setContextStyle:function(t){var e=t.lineWidth,r=void 0===e?0:e,n=t.color,o=void 0===n?"#333":n,s=t.fillColor,a=void 0===s?"#333":s,l=t.opacity,h=void 0===l?1:l,c=this._ctx,u=i.Util.getDpr();c.strokeStyle=o,c.fillStyle=a,c.lineWidth=r*u,c.globalAlpha=h,c.lineCap="round",c.lineJoin="round"},drawTimer:function(){this._drawTimer&&(clearTimeout(this._drawTimer),this._drawTimer=null);var t=this;this._drawTimer=setTimeout((function(){t.draw()}),333)},draw:function(){var t=this._ctx;t.save(),this.drawRoi();for(var e=this.oMaskActions,i=0,r=e.length;i<r;i++){var n=e[i],o=n.type,s=n.segments,a=void 0===s?[]:s,l=n.image;switch(o){case"drawMask":this.drawMaskActionSegments(a);break;case"imgMask":this.drawMaskActionImg(l);case"clearMask":this.clearMaskActionSegments(a)}}t.restore()},drawMaskActionSegments:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=this._map,r=this._ctx,n=0,o=t.length;n<o;n++){var s=t[n],a=s.type,l=s.point,h=s.radius,c=s.points,u=void 0===c?[]:c,d=s.color,y=s.opacity,f=void 0===y?1:y;switch(this.setContextStyle({fillColor:d,color:d,lineWidth:0,opacity:f}),a){case"circle":var p=h*i.Util.worldToScreenDistance(e,1);i.Graph.drawGeoPoint(e,r,l,p);break;case"polygon":i.Graph.drawGeoPolygon(e,r,u,!0)}}},drawMaskActionImg:function(t){var e=t.width,i=t.height,r=this.getLayerContainer(),n=this.getImgMaskActionClipArea(e,i),o=n.x,s=n.y,a=n.width,l=n.height;this._ctx.drawImage(t,o,s,a,l,0,0,r.width,r.height)},getImgMaskActionClipArea:function(t,e){var i=this._map.zoom,r=this._map.getCenter(),n=this._map,o=n.w,s=i*n.h/o;return{x:t/2-i/2+r.x,y:e/2-s/2-r.y,width:i,height:s}},clearMaskActionSegments:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=0,i=t.length;e<i;e++){var r=t[e],n=r.type,o=r.point,s=r.radius,a=r.points,l=void 0===a?[]:a;switch(n){case"circle":this.clearMaskWithCircleSegment({point:o,radius:s});break;case"polygon":this.clearMaskWithPolygonSegment({points:l})}}},clearMaskWithCircleSegment:function(t){var e=t.point,r=t.radius,n=this._map,o=r*i.Util.worldToScreenDistance(n,1);this.clearMaskWithCircleSegmentInner({point:e,radius:o})},clearMaskWithCircleSegmentInner:function(t){var e=t.point,r=t.radius,n=this._map,o=this._ctx,s=this.getLayerContainer(),a=s.width,l=s.height,h=i.Util.getDpr();i.Graph.clearGeoArc(n,e,r*h,o,a,l)},clearMaskWithPolygonSegment:function(t){var e=t.points,r=void 0===e?[]:e,n=this._map,o=this._ctx,s=this.getLayerContainer(),a=s.width,l=s.height;i.Graph.clearGeoPolygon(n,r,o,a,l)},setRoi:function(t){this._roi=t,this.renew()},drawRoi:function(){var t=this._roi,e=this._map,r=this._ctx;!t||t.length<3||i.Graph.drawGeoRoi(e,t,r)},getMaskActionsWithPixels1:function(t,e){var r=this._actionRelations;for(var n in r){var o=r[n];i.worker.runWorker({method:i.worker.getMaskPixels,message:{workerSingle:"multiple",canvasSize:{width:t,height:e},actions:o},callback:function(t){console.log("来自子线程信息：hi，主人，我已经计算完成了"),console.log("res",t)}})}},getMaskActionsWithPixels2:function(t,e){var r=this._actionRelations,n=(new Date).getTime();i.worker.runWorker({method:i.worker.getMaskPixels,message:{workerSingle:"single",canvasSize:{width:t,height:e},actions:r},callback:function(t){console.log("来自子线程信息：hi，主人，我已经计算完成了");var e=(new Date).getTime()-n;console.log("计算耗时：",e)}})},getMaskActionsWithPixels:function(t,e){var i=this._actionRelations,r=this.getCanvas(t,e),n=r.getContext("2d"),o=(new Date).getTime(),s=[];for(var a in i){n.clearRect(0,0,t,e);var l=i[a];this.renderMaskWithActions(r,l);var h=this.getRlePixelData(r);s.push({pixels:h,key:a})}var c=(new Date).getTime()-o;return console.log("计算耗时：",c),console.log("result",s),s},getCanvas:function(t,e){var i=new OffscreenCanvas(t,e),r=i.getContext("2d");return r.fillStyle="#000000",r.strokeStyle="#000000",r.globalAlpha=1,i},renderMaskWithActions:function(t,e){var i=e.targetAction,r=e.relatedMaskActions,n=void 0===r?[]:r,o=i.type,s=i.segments,a=void 0===s?[]:s,l=i.image;"drawMask"===o&&this.renderDrawMaskSegments(t,a),"imgMask"===o&&this.renderImageMask(t,l);for(var h=0,c=n.length;h<c;h++){var u=n[h],d=u.type,y=u.segments,f=void 0===y?[]:y,p=u.image;"drawMask"===d&&this.renderDrawMaskSegments(t,f),"imgMask"===d&&this.renderImageMask(t,p),"clearMask"===d&&this.renderClearMaskSegments(t,f)}},renderDrawMaskSegments:function(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],i=0,r=e.length;i<r;i++){var n=e[i];switch(n.type){case"circle":this.renderDrawMaskSegmentCircle(t,n);break;case"polygon":this.renderDrawMaskSegmentPolygon(t,n)}}},renderImageMask:function(t,e){t.getContext("2d").drawImage(e,0,0)},renderClearMaskSegments:function(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],i=0,r=e.length;i<r;i++){var n=e[i];switch(n.type){case"circle":this.renderClearMaskSegmentCircle(t,n);break;case"polygon":this.renderClearMaskSegmentPolygon(t,n)}}},renderDrawMaskSegmentCircle:function(t,e){var i=t.getContext("2d"),r=t.width,n=t.height,o=e.point,s=e.radius,a={x:o.x+r/2,y:n/2-o.y};i.beginPath(),i.arc(a.x,a.y,s,0,2*Math.PI,!0),i.closePath(),i.fill()},renderDrawMaskSegmentPolygon:function(t,e){var i=t.getContext("2d"),r=t.width,n=t.height,o=e.points,s=void 0===o?[]:o,a=s.length;if(2<=a){i.beginPath();var l={x:s[0].x+r/2,y:n/2-s[0].y};i.moveTo(l.x,l.y);for(var h=1;h<a;h++){var c={x:s[h].x+r/2,y:n/2-s[h].y};i.lineTo(c.x,c.y)}i.closePath()}i.stroke(),i.fill()},renderClearMaskSegmentCircle:function(t,e){var i=t.getContext("2d"),r=t.width,n=t.height,o=e.point,s=e.radius,a={x:o.x+r/2,y:n/2-o.y};i.save(),i.beginPath(),i.arc(a.x,a.y,s,0,2*Math.PI),i.clip(),i.clearRect(0,0,r,n),i.restore()},renderClearMaskSegmentPolygon:function(t,e){var i=t.getContext("2d"),r=t.width,n=t.height,o=e.points,s=void 0===o?[]:o;i.save(),i.beginPath();var a=s.length;if(2<=a){i.beginPath();var l={x:s[0].x+r/2,y:n/2-s[0].y};i.moveTo(l.x,l.y);for(var h=1;h<a;h++){var c={x:s[h].x+r/2,y:n/2-s[h].y};i.lineTo(c.x,c.y)}i.closePath()}i.clip(),i.clearRect(0,0,r,n),i.restore()},getPixelData:function(t){for(var e=[],i=t.getContext("2d"),r=t.width,n=t.height,o=i.getImageData(0,0,r,n).data,s=0;s<n;s++)for(var a=0;a<r;a++){var l=4*(s*r+a),h=o[l],c=o[l+1],u=o[l+2],d=o[l+3];(h||c||u||d)&&e.push([s+1,a+1])}return e},getRlePixelData:function(t){for(var e=[],i=t.getContext("2d"),r=t.width,n=t.height,o=i.getImageData(0,0,r,n).data,s=0,a=0,l=0;l<n;l++)for(var h=0;h<r;h++){var c=4*(l*r+h),u=o[c],d=o[c+1],y=o[c+2],f=o[c+3],p=+!!(u||d||y||f);p===a?s++:(e.push(s),s=1),l+1===n&&h+1===r&&e.push(s),a=p}return e}}),i.Layer.Marker=i.Layer.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:20},this.id=t,this.oClass="markerLayer",this.oMarkers=[]},privateInitLayerContainer:function(t,e,r){var n=i.Util.createDiv(t,e,r,!0);this._layerContainer=n},addMarker:function(t){i.Util.isInArray(this.oMarkers,t)||(this.oMarkers.push(t),t.onAdd(this))},removeMarker:function(t){for(var e=[],i=0,r=0;i<this.oMarkers.length;i++)this.oMarkers[i]!==t?(e[r]=this.oMarkers[i],r++):this.oMarkers[i].onRemove(this);this.oMarkers=e,this.renew()},removeMarkerById:function(t){for(var e=[],i=0,r=this.oMarkers.length;i<r;i++){var n=this.oMarkers[i];n.id!==t?e.push(n):n.onRemove(this)}this.oMarkers=e,this.renew()},removeMarkersByIds:function(t){for(var e=[],i=[],r=0,n=this.oMarkers.length;r<n;r++){var o=this.oMarkers[r];-1===t.indexOf(o.id)?e.push(o):(o.onRemove(this),i.push(o))}return this.oMarkers=e,this.renew(),i},getAllMarkers:function(){return this.oMarkers},getMarkerById:function(t){for(var e=0;e<this.oMarkers.length;e++)if(this.oMarkers[e].id===t)return this.oMarkers[e];return null},addMarkers:function(t){for(var e=0;e<t.length;e++)this.addMarker(t[e])},removeMarkers:function(t){for(var e=t,i=e.length,r=0;r<i;r++){var n=e[r];this.removeMarker(n)}},removeAllMarkers:function(){var t=this.oMarkers;this.removeMarkers(t)},renew:function(){this._super();for(var t=0;t<this.oMarkers.length;t++)this.oMarkers[t].renew()},resize:function(){this._super(),this.renew()}}),i.Layer.Text=i.Layer.extend({init:function(t,e){e=e||{opacity:1,zIndex:19},this._super(t,e),this.textStyle=e.style||new i.Style({}),this.editable=!0,this.oClass="textLayer",this.oTexts=[]},privateInitLayerContainer:function(t,e,r){var n=i.Util.createCanvas(t,e,r,!0);this._layerContainer=n,this._ctx=n.getContext("2d"),this._layerContainer.style.left="0",this._layerContainer.style.top="0"},addText:function(t){i.Util.isInArray(this.oTexts,t)||(this.oTexts.push(t),t.onAdd(this))},removeText:function(t){for(var e=[],i=0,r=0;i<this.oTexts.length;i++)this.oTexts[i]!==t?(e[r]=this.oTexts[i],r++):this.oTexts[i].onRemove(this);this.oTexts=e,this.renew()},getTextById:function(t){for(var e=0;e<this.oTexts.length;e++)if(this.oTexts[e].id===t)return this.oTexts[e];return null},removeTextById:function(t){for(var e=[],i=0,r=this.oTexts.length;i<r;i++){var n=this.oTexts[i];n.id!==t?e.push(n):n.onRemove(this)}this.oTexts=e,this.renew()},removeTextsByIds:function(t){for(var e=[],i=[],r=0,n=this.oTexts.length;r<n;r++){var o=this.oTexts[r];-1===t.indexOf(o.id)?e.push(o):(o.onRemove(this),i.push(o))}return this.oTexts=e,this.renew(),i},addTexts:function(t){for(var e=0;e<t.length;e++)this.addText(t[e])},removeTexts:function(t){for(var e=t,i=e.length,r=0;r<i;r++){var n=e[r];this.removeText(n)}},getAllTexts:function(){return this.oTexts},removeAllTexts:function(){this.oTexts=[],this.renew()},renew:function(t){this._super(),this.clear(),"mouseWheel"===t?this.drawTimer():this.draw()},drawTimer:function(){this._drawTimer&&(clearTimeout(this._drawTimer),this._drawTimer=null);var t=this;this._drawTimer=setTimeout((function(){t.draw()}),333)},resize:function(){this._super();var t=i.Util.getDpr();this._layerContainer.width=this._map.w*t,this._layerContainer.height=this._map.h*t,this.renew()},clear:function(){var t=this.getLayerContainer();this._ctx.clearRect(0,0,t.width,t.height)},getCtx:function(){return this._ctx},draw:function(){for(var t=this.getAllTexts(),e=0,i=t.length;e<i;e++)t[e].onDraw(this)}}),i.Layer.Text2=i.Layer.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:19},this.id=t,this.oClass="textLayer",this.oTexts=[]},privateInitLayerContainer:function(t,e,r){var n=i.Util.createDiv(t,e,r,!0);this._layerContainer=n},addText:function(t){i.Util.isInArray(this.oTexts,t)||(this.oTexts.push(t),t.onAdd(this))},removeText:function(t){for(var e=[],i=0,r=0;i<this.oTexts.length;i++)this.oTexts[i]!==t?(e[r]=this.oTexts[i],r++):this.oTexts[i].onRemove(this);this.oTexts=e,this.renew()},getTextById:function(t){for(var e=0;e<this.oTexts.length;e++)if(this.oTexts[e].id===t)return this.oTexts[e];return null},removeTextById:function(t){for(var e=[],i=0,r=this.oTexts.length;i<r;i++){var n=this.oTexts[i];n.id!==t?e.push(n):n.onRemove(this)}this.oTexts=e,this.renew()},removeTextsByIds:function(t){for(var e=[],i=[],r=0,n=this.oTexts.length;r<n;r++){var o=this.oTexts[r];-1===t.indexOf(o.id)?e.push(o):(o.onRemove(this),i.push(o))}return this.oTexts=e,this.renew(),i},addTexts:function(t){for(var e=0;e<t.length;e++)this.addText(t[e])},removeTexts:function(t){for(var e=t,i=e.length,r=0;r<i;r++){var n=e[r];this.removeText(n)}},getAllTexts:function(){return this.oTexts},removeAllTexts:function(){this._layerContainer.innerHTML="",this.oTexts=[],this.renew()},renew:function(){this._super();for(var t=0;t<this.oTexts.length;t++)this.oTexts[t].renew()},resize:function(){this._super(),this.renew()}}),i.Layer.Roi=i.Layer.extend({init:function(t,e){e=e||{opacity:1,zIndex:2},this._super(t,e),this.roiStyle=e.style||new i.Style({});var r=new Image;r.src=i.constants.textureIcon,this.imageTexture=r,this.editable=!0,this.oClass="roiLayer",this.roiAreas=[]},setEditable:function(t){this.editable=!!t},privateInitLayerContainer:function(t,e,r){var n=i.Util.createCanvas(t,e,r,!0);this._layerContainer=n,this._ctx=n.getContext("2d"),this._layerContainer.style.left=0,this._layerContainer.style.top=0},addFeature:function(t){var e=!0;t.onAdd(this);var r=i.Util.roiAreasOrderByLevel(this.roiAreas);if(r.length){var n=this.getParentRoiArea(r,t);if(!n)return;if(n.children&&n.children.length)for(var o=0;o<n.children.length;o++)if(i.Util.polygonCross(n.children[o].points,t.points)){e=!1;break}e&&t&&this.updateRoiAreas(this.roiAreas,n,t)}else this.roiAreas.push(t);return e&&this.renew(),e},getParentRoiArea:function(t,e){var r;if(!t.length)return null;for(var n=0;n<t.length;n++)if(t[n].roiType!==e.roiType&&i.Util.polygonInPolygon(e.points,t[n].points)){r=t[n];break}return r},updateRoiAreas:function(t,e,i){for(var r=0;r<t.length;r++){if(e.id===t[r].id){t[r].children?t[r].children.push(i):t[r].children=[i];break}t[r].children&&this.updateRoiAreas(t[r].children,e,i)}},getAllRoiAreas:function(){return this.roiAreas||[]},renew:function(){var t=this;this._super(),this.clear(),this.roiAreas.forEach((function(e){return t.draw(e)}))},draw:function(t){var e=this,r=this._ctx,n=t.gStyle,o=i.Util.getDpr();if(i.Util.setStyle(r,n),t.hoverStatus&&!t.activeStatus&&(r.lineWidth=2*n.lineWeight*o),t.activeStatus){var s=t.activeStyle.strokeColor;r.strokeStyle=s}r.setLineDash([]),r.globalAlpha=1,r.beginPath();var a=t.points.length,l=i.Util.worldToScreen(this._map,t.points[0].x,t.points[0].y),h=i.Util.transformScreenXYWithDpr(l);r.moveTo(h.x,h.y);for(var c=1;c<a;c++)l=i.Util.worldToScreen(this._map,t.points[c].x,t.points[c].y),h=i.Util.transformScreenXYWithDpr(l),r.lineTo(h.x,h.y);r.closePath(),r.stroke();var u=r.createPattern(this.imageTexture,"repeat");r.strokeStyle=u,r.fillStyle=u,r.fill(),"roi"===t.roiType&&i.Graph.clearGeoPolygon(this._map,t.points,r,this._layerContainer.width,this._layerContainer.height),t.children&&t.children.forEach((function(t){return e.draw(t)})),t.setVerticesActiveStatus(this)},clear:function(){var t=this.getLayerContainer();this._ctx.clearRect(0,0,t.width,t.height)},removeAllRois:function(){this.roiAreas=[],this.renew()},getFeaturesWithPos:function(t,e){if(!this.editable)return[];for(var r=[],n=this.getAllRoiAreas(),o=i.Util.roiAreasOrderByLevel(n),s=0;s<o.length-1;s++){var a=o[s],l=!0;e&&"active"===e&&(l=a.activeStatus),e&&"hover"===e&&(l=!0),a.isCaught(t)&&l&&r.push(a)}return r},resetFeatureStatus:function(t){var e=this.getAllRoiAreas(),i=!1;return function e(r){for(var n=0;n<r.length;n++){var o=r[n];t&&"active"===t?o.activeStatus&&(o.activeStatus=!1,i=!0):t&&"hover"===t?o.hoverStatus&&(o.hoverStatus=!1,i=!0):(o.activeStatus||o.hoverStatus)&&(o.activeStatus=!1,o.hoverStatus=!1,i=!0),o.children&&e(o.children)}}(e),i&&this.renew(),i},resize:function(){this._super();var t=i.Util.getDpr();this._layerContainer.width=this._map.w*t,this._layerContainer.height=this._map.h*t,this.renew()},catchFeaturePointWithPos:function(t,e){for(var r=[],n=this.getAllRoiAreas(),o=i.Util.roiAreasOrderByLevel(n),s=o.length-1;0<=s;s--){var a=o[s],l=!0;e&&"active"===e&&(l=a.activeStatus);var h=a.catchPointWithPos(this,t);h.flag&&l&&r.push({feature:a,point:h.point})}return r},validateFeatureWithNewPoints:function(t,e){var r=this.roiAreas,n=i.Util.getParent(r,t),o=n[n.length-1],s=o.points,a=e;return i.Util.polygonInPolygon(a,s)&&!i.Util.polygonCrossWithParentChildren(t,o,e)&&i.Util.childrenInCurrentPolygon(e,t)}}),i.Control=e.extend({init:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=(new Date).getTime()+"";this.id=t||i,this._controlContainer=this.generateContainer(),this._controlContainer.id=t,this.setControlContainerPosition(e)},setControlContainerPosition:function(t){this._postion=t.postion||t.pos||{right:0,bottom:0};var e=this._postion,i=e.left,r=e.top,n=e.right,o=e.bottom;this._controlContainer.style.position="absolute",this._controlContainer.style.display="inline-block",this._controlContainer.style.zIndex=999999,!isNaN(i)&&(this._controlContainer.style.left=i+"px"),isNaN(i)&&(this._controlContainer.style.left="auto"),!isNaN(r)&&(this._controlContainer.style.top=r+"px"),isNaN(r)&&(this._controlContainer.style.top="auto"),!isNaN(n)&&(this._controlContainer.style.right=n+"px"),isNaN(n)&&(this._controlContainer.style.right="auto"),!isNaN(o)&&(this._controlContainer.style.bottom=o+"px"),isNaN(o)&&(this._controlContainer.style.bottom="auto")},generateContainer:function(){return document.createElement("div")},setVisible:function(t){this.visible=t,this.refresh&&this.refresh()},show:function(){this.visible||this.setVisible(!0)},hide:function(){this.visible&&this.setVisible(!1)},onAdd:function(t){this._map=t,this.visible=!0;var e=this.selfContainer||this.getMapContainer();if(!e||!this._controlContainer)return!1;this.selfContainer&&(this._controlContainer.style.position="relative"),e.appendChild(this._controlContainer)},onRemove:function(){var t=this.selfContainer||this.getMapContainer();if(!t||!this._controlContainer)return!1;try{t.removeChild(this._controlContainer)}catch(t){console.log("ailabel-control-removechild-error")}},getMapContainer:function(){return this._map?this._map.getContainer():null},getMapContainerSize:function(){return this._map?{w:this._map.w,h:this._map.h}:null},getMapZoomScale:function(){var t=this.getMapContainer(),e=this.getMapZoom(),i=(this.getMapContainerSize()||{}).w;return!!(t&&e&&i)&&e/i},getMapZoom:function(){if(this._map)return this._map.getZoom()},getMapHZoom:function(){var t=this.getMapZoomScale(),e=this.getMapContainerSize();if(t&&e)return t*e.h},getContainerInfo:function(){this._map},boundsWatch:function(){},resize:function(){this.refresh()},refresh:function(){this.onDraw()}}),i.Control.Scale=i.Control.extend({init:function(t,e){var r=e||{};this._super(t,r),this._style=r.style||new i.Style({opacity:0}),this.type="scale"},onAdd:function(t){this._super(t),this.setContainerProps(),this.onDraw(t)},onDraw:function(){var t=this.getMapZoomScale();t&&this.setScaleContent(t)},setContainerProps:function(){if(!this._controlContainer)return console.warn("controlContainer不存在：setContainerProps:function"),!1;var t=this._style;this._controlContainer.style.fontSize=t.fontSize+"px",this._controlContainer.style.fontFamily=t.fontFamily+",SimSun",this._controlContainer.style.color=t.fontColor,this._controlContainer.style.padding="2px";var e=t.opacity||0===t.opacity?t.opacity:1,r=i.Util.colorRgb(t.bgColor,e);this._controlContainer.style.background=r},setScaleContent:function(t){if(!this._controlContainer)return console.warn("controlContainer不存在：setScaleContent:function"),!1;var e=parseInt(100*t,10)+"/100";this._controlContainer.textContent=e||"--/--"},boundsWatch:function(){this._super(),this.onDraw()}}),i.Control.EagleMap=i.Control.extend({init:function(t,e){var i=e||{};this._super(t,i),this.type="eagleMap",this._image=i.image||{src:"",width:0,height:0},this._imageId="image-"+t,this._size=i.size||{width:200,height:150},this._type=-1<["default","grid"].indexOf(i.type)?i.type:"default",this._activeGridElement=null,i.container&&document.getElementById(i.container)&&(this.selfContainer=document.getElementById(i.container)),this._controlContainerBorderWidth=1,this._controlContainerProps=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},r=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),r.forEach((function(e){var r,n,o;r=t,o=i[n=e],n in r?Object.defineProperty(r,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[n]=o}))}return t}({display:"-webkit-box",webkitBoxPack:"center",webkitBoxAlign:"center",boxSizing:"border-box",borderRadius:"0",overflow:"hidden",zIndex:999999,border:this._controlContainerBorderWidth+"px solid #eaeaea"},"grid"===this._type?{backgroundColor:"#000"}:{}),this._highlightProps={border:"2px solid #ff0000",borderRadius:"2px",position:"absolute",boxSizing:"border-box",left:0,top:0,width:0,height:0},this._gridConfig=!!i.grid&&Object.assign({},{rowCount:3,columnCount:3,color:"#000"},i.grid),this._gridProps={position:"absolute",left:"50%",top:"50%",width:0,height:0};var r=this._gridConfig||{},n=r.columnCount,o=void 0===n?1:n,s=r.rowCount,a=void 0===s?1:s,l=r.color,h=void 0===l?"#000":l;this._gridCellProps="default"===this._type?{display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",float:"left",border:"0 solid "+h,cursor:"pointer",width:100/o+"%",height:100/a+"%",borderRightWidth:"1px",borderBottomWidth:"1px"}:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",float:"left",border:"0 solid "+h,cursor:"pointer",width:100/o+"%",height:100/a+"%",borderRightWidth:"2px",borderBottomWidth:"2px",backgroundColor:"rgba(255, 255, 255, .2)"}},onAdd:function(t){this.selfContainer&&(this.selfContainer.innerHTML=""),this._super(t),this.setContainerProps(),this.setPropsRelatedWithImageInfo(),"default"===this._type&&(this.addImage(),this.addHighlightRect()),this.addGrid(),this.onDraw(t)},setPropsRelatedWithImageInfo:function(){var t=this._image,e=t.width,i=t.height,r=this._size,n=r.width,o=r.height;this._zoom=n/o<=e/i?(this._imageScreenWidth=n,this._imageScreenHeight=i*n/e,e):(this._imageScreenWidth=e*o/i,this._imageScreenHeight=o,e*n/this._imageScreenWidth)},addImage:function(){var t=this._image,e=t.src,i=t.width,r=t.height,n=this._size,o=n.width,s=n.height;this._mapImg=document.createElement("img"),this._mapImg.id=this._imageId,this._mapImg.src=e,o/s<=i/r?this._mapImg.style.width="100%":this._mapImg.style.height="100%",this._mapImg.style.display="block",this._mapImg.style.margin="0 auto",this._controlContainer.appendChild(this._mapImg)},addHighlightRect:function(){for(var t in this._highlight=document.createElement("div"),this._highlightProps)this._highlight.style[t]=this._highlightProps[t];this._controlContainer.appendChild(this._highlight)},changeHighlightRectSize:function(t,e){if(!this._highlight)return!1;this._highlight.style.width=t+"px",this._highlight.style.height=e+"px"},changeHighlightRectPosition:function(t,e){if(!this._highlight)return!1;var i=-this._controlContainerBorderWidth;this._highlight.style.left=t+i+"px",this._highlight.style.top=e+i+"px"},addGrid:function(){var t=this._imageScreenWidth,e=this._imageScreenHeight;if(this._grid=document.createElement("div"),this._grid.className="ailabel-control-eagle-map-grid","default"===this._type){if(!this._gridConfig||!t||!e)return;this._gridProps.width=t+"px",this._gridProps.height=e+"px",this._gridProps.marginLeft=-t/2+"px",this._gridProps.marginTop=-e/2+"px"}else{if(!this._gridConfig)return;this._gridProps.width="100%",this._gridProps.height="100%",this._gridProps.left=0,this._gridProps.top=0}for(var i in this._gridProps)this._grid.style[i]=this._gridProps[i];for(var r=this._gridConfig,n=r.columnCount,o=r.rowCount,s=0;s<o;s++)for(var a=0;a<n;a++){var l=document.createElement("div");for(var h in this._gridCellProps)l.style[h]=this._gridCellProps[h];a+1===n&&(l.style.borderRightWidth=0),s+1===o&&(l.style.borderBottomWidth=0),"grid"===this._type&&(l.innerHTML='<svg t="1573368358416" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7399" width="80%" height="80%"><path d="M289 802.2l190.7-190.7-67.9-67.9-186.1 186.1V571l-96 0.1v327l0.1 0.1 327 0.1v-96l-167.8-0.1z m-63.3-2.6l2.6 2.6h-2.6v-2.6z m671.2-671.2l-327.1 0.1v95.8l161.2 0.1-189.7 189.7 67.9 67.9L801 290.2v165.3l95.9 0.1V128.5z" fill="#fff" p-id="7400"></path></svg>'),l.setAttribute("data-row",s+1),l.setAttribute("data-column",a+1),this.bindGridCellHoverStyle(l),this.bindGridCellEvent(l),this._grid.appendChild(l)}this._controlContainer.appendChild(this._grid)},bindGridCellHoverStyle:function(t){var e=this;t.onmouseover=function(){"default"===e._type&&(this.style.boxShadow="0 2px 2px gray")},t.onmouseout=function(){"default"===e._type&&(this.style.boxShadow="none")}},bindGridCellEvent:function(t){var e=this,i=e.getMapZoom(),r=e.getMapContainerSize();e._map&&i&&r&&(t.onclick=function(){var t=1*this.getAttribute("data-row"),i=1*this.getAttribute("data-column"),n=e.getGridCellCenter(t,i),o=n.x,s=n.y,a=r.w,l=r.h,h=e.getGridCellWordWidthAndHeight(),c=h.width,u=h.height,d=a/l<=c/u?1.2*c:a/l*u*1.2;if(e._map.centerAndZoom({x:o,y:s},d),"grid"===e._type){this.style.backgroundColor="rgba(16,140,238,.2)",e._activeGridElement&&(e._activeGridElement.style.border=""),(e._activeGridElement=this).style.border="1px solid red";var y=this.querySelector("svg path");y&&(y.style.fill="#108CEE")}})},getGridCellCenter:function(t,e){var i=this._gridConfig||{},r=i.columnCount,n=void 0===r?1:r,o=i.rowCount,s=void 0===o?1:o,a=this.getGridCellWordWidthAndHeight(),l=a.width,h=a.height;return{x:(e-n/2)*l-l/2,y:(s/2-t)*h+h/2}},getGridCellWordWidthAndHeight:function(){var t=this.getGridCellScreenWidthAndHeight(),e=t.width,i=t.height,r=this.getEagleMapScale();return{width:r*e,height:r*i}},getGridCellScreenWidthAndHeight:function(){var t=this._gridConfig||{},e=t.columnCount,i=void 0===e?1:e,r=t.rowCount,n=void 0===r?1:r;return{width:this._imageScreenWidth/i,height:this._imageScreenHeight/n}},onDraw:function(){var t=this.getMapZoom(),e=this.getMapHZoom(),i=this.getEagleMapScale();if(!t||!e||!i)return!1;var r=parseInt(t/i,10),n=parseInt(e/i,10);this.changeHighlightRectSize(r,n);var o=this.getLeftTopWordPosition();this.changeHighlightRectPosition(o.x,o.y)},getEagleMapScale:function(){var t=this._size.width;return this._zoom/t},setContainerProps:function(){if(!this._controlContainer)return console.warn("controlContainer不存在：setContainerProps:function"),!1;for(var t in this._controlContainer.onclick=function(t){t.stopPropagation(),t.cancelBubble=!0},this._controlContainerProps)this._controlContainer.style[t]=this._controlContainerProps[t];this._controlContainer.style.width=this._size.width+"px",this._controlContainer.style.height=this._size.height+"px"},getLeftTopWordPosition:function(){var t=i.Util.screenToWorld(this._map,0,0),e=this._size,r=e.width,n=e.height,o=this.getEagleMapScale(),s=parseInt(r,10)/2,a=parseInt(n,10)/2;return{x:parseFloat(s)+parseFloat((t.x-0)/o)+0,y:parseFloat(a)-parseFloat((t.y-0)/o)+0}},boundsWatch:function(){this._super(),this.onDraw(),this._activeGridElement&&(this._activeGridElement.style.border="")}}),i}))},a434:function(t,e,i){"use strict";var r=i("23e7"),n=i("23cb"),o=i("a691"),s=i("50c4"),a=i("7b0b"),l=i("65f0"),h=i("8418"),c=i("1dde"),u=i("ae40"),d=c("splice"),y=u("splice",{ACCESSORS:!0,0:0,1:2}),f=Math.max,p=Math.min,g=9007199254740991,v="Maximum allowed length exceeded";r({target:"Array",proto:!0,forced:!d||!y},{splice:function(t,e){var i,r,c,u,d,y,x=a(this),m=s(x.length),w=n(t,m),C=arguments.length;if(0===C?i=r=0:1===C?(i=0,r=m-w):(i=C-2,r=p(f(o(e),0),m-w)),m+i-r>g)throw TypeError(v);for(c=l(x,r),u=0;u<r;u++)d=w+u,d in x&&h(c,u,x[d]);if(c.length=r,i<r){for(u=w;u<m-r;u++)d=u+r,y=u+i,d in x?x[y]=x[d]:delete x[y];for(u=m;u>m-r+i;u--)delete x[u-1]}else if(i>r)for(u=m-r;u>w;u--)d=u+r-1,y=u+i-1,d in x?x[y]=x[d]:delete x[y];for(u=0;u<i;u++)x[u+w]=arguments[u+2];return x.length=m-r+i,c}})},b680:function(t,e,i){"use strict";var r=i("23e7"),n=i("a691"),o=i("408a"),s=i("1148"),a=i("d039"),l=1..toFixed,h=Math.floor,c=function(t,e,i){return 0===e?i:e%2===1?c(t,e-1,i*t):c(t*t,e/2,i)},u=function(t){var e=0,i=t;while(i>=4096)e+=12,i/=4096;while(i>=2)e+=1,i/=2;return e},d=l&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!a((function(){l.call({})}));r({target:"Number",proto:!0,forced:d},{toFixed:function(t){var e,i,r,a,l=o(this),d=n(t),y=[0,0,0,0,0,0],f="",p="0",g=function(t,e){var i=-1,r=e;while(++i<6)r+=t*y[i],y[i]=r%1e7,r=h(r/1e7)},v=function(t){var e=6,i=0;while(--e>=0)i+=y[e],y[e]=h(i/t),i=i%t*1e7},x=function(){var t=6,e="";while(--t>=0)if(""!==e||0===t||0!==y[t]){var i=String(y[t]);e=""===e?i:e+s.call("0",7-i.length)+i}return e};if(d<0||d>20)throw RangeError("Incorrect fraction digits");if(l!=l)return"NaN";if(l<=-1e21||l>=1e21)return String(l);if(l<0&&(f="-",l=-l),l>1e-21)if(e=u(l*c(2,69,1))-69,i=e<0?l*c(2,-e,1):l/c(2,e,1),i*=4503599627370496,e=52-e,e>0){g(0,i),r=d;while(r>=7)g(1e7,0),r-=7;g(c(10,r,1),0),r=e-1;while(r>=23)v(1<<23),r-=23;v(1<<r),g(1,1),v(2),p=x()}else g(0,i),g(1<<-e,0),p=x()+s.call("0",d);return d>0?(a=p.length,p=f+(a<=d?"0."+s.call("0",d-a)+p:p.slice(0,a-d)+"."+p.slice(a-d))):p=f+p,p}})}}]);